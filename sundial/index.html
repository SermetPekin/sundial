
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../equation_of_time/">
      
      
        <link rel="next" href="../api_reference/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.34">
    
    
      
        <title>Sundial Calculations - The Analemma Package</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.35f28582.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#sundial-calculations" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="The Analemma Package" class="md-header__button md-logo" aria-label="The Analemma Package" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            The Analemma Package
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Sundial Calculations
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="The Analemma Package" class="md-nav__button md-logo" aria-label="The Analemma Package" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    The Analemma Package
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../sundial_plots/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Analemma Plots
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../equation_of_time/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The Equation of Time
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Sundial Calculations
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Sundial Calculations
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setup-and-definitions" class="md-nav__link">
    <span class="md-ellipsis">
      Setup and Definitions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setup and Definitions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fixed-stars-frame" class="md-nav__link">
    <span class="md-ellipsis">
      Fixed Stars Frame
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#earth-frame" class="md-nav__link">
    <span class="md-ellipsis">
      Earth Frame
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#surface-frame" class="md-nav__link">
    <span class="md-ellipsis">
      Surface Frame
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#orbit-rotor-and-meridian-plane" class="md-nav__link">
    <span class="md-ellipsis">
      Orbit Rotor and Meridian Plane
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dial-face-and-gnomon" class="md-nav__link">
    <span class="md-ellipsis">
      Dial face and gnomon
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-calculation" class="md-nav__link">
    <span class="md-ellipsis">
      The Calculation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The Calculation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-simplifying-assumption" class="md-nav__link">
    <span class="md-ellipsis">
      A Simplifying Assumption
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-shadow-plane" class="md-nav__link">
    <span class="md-ellipsis">
      The Shadow Plane
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-hour-angle" class="md-nav__link">
    <span class="md-ellipsis">
      The Hour Angle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-shadow-angle" class="md-nav__link">
    <span class="md-ellipsis">
      The Shadow Angle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-shadow-length" class="md-nav__link">
    <span class="md-ellipsis">
      The Shadow Length
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-shadow-coordinates" class="md-nav__link">
    <span class="md-ellipsis">
      The Shadow Coordinates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#angle-between-sun-ray-and-dial-face" class="md-nav__link">
    <span class="md-ellipsis">
      Angle Between Sun Ray and Dial Face
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-sundial-module" class="md-nav__link">
    <span class="md-ellipsis">
      Test sundial Module
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../api_reference/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setup-and-definitions" class="md-nav__link">
    <span class="md-ellipsis">
      Setup and Definitions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setup and Definitions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fixed-stars-frame" class="md-nav__link">
    <span class="md-ellipsis">
      Fixed Stars Frame
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#earth-frame" class="md-nav__link">
    <span class="md-ellipsis">
      Earth Frame
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#surface-frame" class="md-nav__link">
    <span class="md-ellipsis">
      Surface Frame
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#orbit-rotor-and-meridian-plane" class="md-nav__link">
    <span class="md-ellipsis">
      Orbit Rotor and Meridian Plane
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dial-face-and-gnomon" class="md-nav__link">
    <span class="md-ellipsis">
      Dial face and gnomon
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-calculation" class="md-nav__link">
    <span class="md-ellipsis">
      The Calculation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The Calculation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-simplifying-assumption" class="md-nav__link">
    <span class="md-ellipsis">
      A Simplifying Assumption
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-shadow-plane" class="md-nav__link">
    <span class="md-ellipsis">
      The Shadow Plane
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-hour-angle" class="md-nav__link">
    <span class="md-ellipsis">
      The Hour Angle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-shadow-angle" class="md-nav__link">
    <span class="md-ellipsis">
      The Shadow Angle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-shadow-length" class="md-nav__link">
    <span class="md-ellipsis">
      The Shadow Length
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-shadow-coordinates" class="md-nav__link">
    <span class="md-ellipsis">
      The Shadow Coordinates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#angle-between-sun-ray-and-dial-face" class="md-nav__link">
    <span class="md-ellipsis">
      Angle Between Sun Ray and Dial Face
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-sundial-module" class="md-nav__link">
    <span class="md-ellipsis">
      Test sundial Module
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="sundial-calculations">Sundial Calculations</h1>
<p>This notebook accompanies my <a href="https://russellgoyder.github.io/sundial-latex/">sundial paper</a>. I originally used <a href="https://www.maplesoft.com/">Maple</a> for the calculations, but decided to reproduce them here to make the analysis more accessible, and as a way to learn <a href="https://www.sympy.org/en/index.html">SymPy</a> and <a href="https://github.com/pygae/galgebra">GAlgebra</a>. I used my <a href="https://russellgoyder.github.io/geometric-algebra-cheat-sheet/">cheat sheet</a> for Geometric Algebra at various points.</p>
<p>Run the notebook yourself: <a href="https://mybinder.org/v2/gh/russellgoyder/sundial/HEAD?labpath=docs/sundial.ipynb"><img alt="Binder" src="https://mybinder.org/badge_logo.svg" /></a></p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">sympy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">tan</span>
<span class="kn">from</span> <span class="nn">sympy.abc</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">galgebra</span> <span class="kn">import</span> <span class="n">mv</span>
<span class="kn">from</span> <span class="nn">galgebra.ga</span> <span class="kn">import</span> <span class="n">Ga</span>
<span class="kn">from</span> <span class="nn">galgebra.printer</span> <span class="kn">import</span> <span class="n">latex</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Math</span>

<span class="n">sp</span><span class="o">.</span><span class="n">init_printing</span><span class="p">()</span>

<span class="c1"># Multivector mv on its own in a cell appears fine in the notebook but when nbconverted</span>
<span class="c1"># to Markdown comes out as \begin{equation*} x \end{equation*} instead of eg $\displaystyle x$</span>
<span class="c1"># and consequently isn&#39;t rendered in HTML after running mkdocs.</span>
<span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="n">mv</span><span class="p">):</span>
    <span class="k">return</span><span class="p">(</span><span class="n">Math</span><span class="p">(</span><span class="n">latex</span><span class="p">(</span><span class="n">mv</span><span class="p">)))</span>
</code></pre></div>
<h2 id="setup-and-definitions">Setup and Definitions</h2>
<h3 id="fixed-stars-frame">Fixed Stars Frame</h3>
<p>First, we define the geometric algebra of 3-space and some basis blades from the frame of the "fixed stars"</p>
<p><img alt="Earth's orientation and orbit" src="https://raw.githubusercontent.com/russellgoyder/sundial-latex/main/figs/MainArena.png?token=GHSAT0AAAAAAB73Q3JM6JGFDMRHPPAJKRQ2ZAWFO7Q" title="Earth's orientation and orbit." />.</p>
<div class="highlight"><pre><span></span><code><span class="n">coords</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;1 2 3&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">G3</span> <span class="o">=</span> <span class="n">Ga</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="n">g</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">coords</span><span class="o">=</span><span class="n">coords</span><span class="p">)</span>

<span class="p">(</span><span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">e3</span><span class="p">)</span> <span class="o">=</span> <span class="n">G3</span><span class="o">.</span><span class="n">mv</span><span class="p">()</span>
<span class="n">I</span> <span class="o">=</span> <span class="n">e1</span><span class="o">^</span><span class="n">e2</span><span class="o">^</span><span class="n">e3</span>
</code></pre></div>
<h3 id="earth-frame">Earth Frame</h3>
<p>Now, let the tilt of the earth's plane (axis) of rotation be <span class="arithmatex">\(\alpha\)</span> and measure the earth's rotation by <span class="arithmatex">\(\psi\)</span>. Then we can define the Earth frame as follows.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span><span class="n">mv</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">bivec</span><span class="p">):</span>
    <span class="n">rotor</span> <span class="o">=</span> <span class="p">(</span> <span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">bivec</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">(</span> <span class="n">rotor</span> <span class="o">*</span> <span class="n">mv</span> <span class="o">*</span> <span class="n">rotor</span><span class="o">.</span><span class="n">rev</span><span class="p">()</span> <span class="p">)</span>

<span class="n">e1_prime</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">e1</span><span class="o">^</span><span class="n">e3</span><span class="p">)</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">()</span>

<span class="n">f1</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">e1_prime</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">e1_prime</span><span class="o">^</span><span class="n">e2</span><span class="p">)</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">()</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">()</span>
<span class="n">f2</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">e2</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">e1_prime</span><span class="o">^</span><span class="n">e2</span><span class="p">)</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">()</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">()</span>
<span class="n">f3</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">e3</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">e1</span><span class="o">^</span><span class="n">e3</span><span class="p">)</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">()</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">print_3frame</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">symbol</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Math</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            \begin</span><span class="se">{{</span><span class="s1">align</span><span class="se">}}</span>
<span class="s1">            </span><span class="si">{</span><span class="n">symbol</span><span class="si">}</span><span class="s1">_1 &amp;= </span><span class="si">{</span><span class="n">latex</span><span class="p">(</span><span class="n">frame</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s1"> \nonumber \\</span>
<span class="s1">            </span><span class="si">{</span><span class="n">symbol</span><span class="si">}</span><span class="s1">_2 &amp;= </span><span class="si">{</span><span class="n">latex</span><span class="p">(</span><span class="n">frame</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="si">}</span><span class="s1"> \nonumber \\</span>
<span class="s1">            </span><span class="si">{</span><span class="n">symbol</span><span class="si">}</span><span class="s1">_3 &amp;= </span><span class="si">{</span><span class="n">latex</span><span class="p">(</span><span class="n">frame</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="si">}</span><span class="s1"> \nonumber</span>
<span class="s1">            \end</span><span class="se">{{</span><span class="s1">align</span><span class="se">}}</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="p">)</span>

<span class="n">print_3frame</span><span class="p">((</span><span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">,</span><span class="n">f3</span><span class="p">),</span> <span class="s2">&quot;f&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
            \begin{align}
            f_1 &amp;= \cos{\left (\alpha  \right )} \cos{\left (\psi  \right )} \boldsymbol{e}_{1} + \sin{\left (\psi  \right )} \boldsymbol{e}_{2} + \sin{\left (\alpha  \right )} \cos{\left (\psi  \right )} \boldsymbol{e}_{3} \nonumber \\
            f_2 &amp;= - \sin{\left (\psi  \right )} \cos{\left (\alpha  \right )} \boldsymbol{e}_{1} + \cos{\left (\psi  \right )} \boldsymbol{e}_{2} - \sin{\left (\alpha  \right )} \sin{\left (\psi  \right )} \boldsymbol{e}_{3} \nonumber \\
            f_3 &amp;= - \sin{\left (\alpha  \right )} \boldsymbol{e}_{1} + \cos{\left (\alpha  \right )} \boldsymbol{e}_{3} \nonumber
            \end{align}
            \]</div>
<p>Check that this is an orthonormal frame</p>
<div class="highlight"><pre><span></span><code><span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">e1</span> <span class="o">^</span> <span class="n">e2</span> <span class="o">^</span> <span class="n">e3</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">f1</span> <span class="o">*</span> <span class="n">f2</span> <span class="o">*</span> <span class="n">f3</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle  0 \]</div>
<p>The equatorial plane should only depend on the tilt of the Earth's axis of spin <span class="arithmatex">\(\alpha\)</span>, not the angle by which it has rotated relative to the fixed stars <span class="arithmatex">\(\psi\)</span>.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># would like to use mv.Fmt but it seems to give LaTeX output which doesn&#39;t render after eg jupyter nbconvert --to Markdown</span>
<span class="k">def</span> <span class="nf">print_eq</span><span class="p">(</span><span class="n">lhs</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">rhs</span> <span class="p">:</span> <span class="n">sp</span><span class="o">.</span><span class="n">Symbol</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Math</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        \begin</span><span class="se">{{</span><span class="s1">equation</span><span class="se">}}</span>
<span class="s1">            </span><span class="si">{</span><span class="n">lhs</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">latex</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span><span class="si">}</span><span class="s1"> \nonumber</span>
<span class="s1">        \end</span><span class="se">{{</span><span class="s1">equation</span><span class="se">}}</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>

<span class="n">print_eq</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;f_1 \wedge f_2&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">f1</span><span class="o">^</span><span class="n">f2</span><span class="p">))</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
        \begin{equation}
            f_1 \wedge f_2 = \cos{\left (\alpha  \right )} \boldsymbol{e}_{1}\wedge \boldsymbol{e}_{2} - \sin{\left (\alpha  \right )} \boldsymbol{e}_{2}\wedge \boldsymbol{e}_{3} \nonumber
        \end{equation}
        \]</div>
<h3 id="surface-frame">Surface Frame</h3>
<p>Define an orthonormal frame embedded in the Earth's surface, with <span class="arithmatex">\(n_1\)</span> pointing South, <span class="arithmatex">\(n_2\)</span> pointing East and <span class="arithmatex">\(n_3\)</span> pointing up.</p>
<p><img alt="" src="https://raw.githubusercontent.com/russellgoyder/sundial-latex/main/figs/SurfaceFrame.png?token=GHSAT0AAAAAAB73Q3JNXNOAJWYLCUINTVLUZAWF6JQ" title="Frame embedded in Earth's surface." />.</p>
<!-- ![](https://raw.githubusercontent.com/russellgoyder/sundial-latex/main/figs/SurfaceFrame.svg?token=GHSAT0AAAAAAB73Q3JNXNOAJWYLCUINTVLUZAWF6JQ "Frame embedded in Earth's surface."). -->

<div class="highlight"><pre><span></span><code><span class="n">n1</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">f3</span><span class="o">^</span><span class="n">f1</span><span class="p">)</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">()</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">()</span>
<span class="n">n2</span> <span class="o">=</span> <span class="n">f2</span>

<span class="c1"># n3 needs a little love</span>
<span class="n">raw_n3</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">f3</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">f3</span><span class="o">^</span><span class="n">f1</span><span class="p">)</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">()</span>
<span class="n">sympy_n3</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">expand_trig</span><span class="p">(</span><span class="n">raw_n3</span><span class="p">))</span> <span class="c1"># galgebra&#39;s Mv doesn&#39;t have expand_trig as a method</span>
<span class="n">n3</span> <span class="o">=</span> <span class="n">mv</span><span class="o">.</span><span class="n">Mv</span><span class="p">(</span><span class="n">sympy_n3</span><span class="p">,</span> <span class="n">ga</span><span class="o">=</span><span class="n">G3</span><span class="p">)</span>

<span class="n">print_3frame</span><span class="p">((</span><span class="n">n1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">n3</span><span class="p">),</span> <span class="s2">&quot;n&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
            \begin{align}
            n_1 &amp;= \left ( \sin{\left (\alpha  \right )} \sin{\left (\theta  \right )} + \cos{\left (\alpha  \right )} \cos{\left (\psi  \right )} \cos{\left (\theta  \right )}\right ) \boldsymbol{e}_{1} + \sin{\left (\psi  \right )} \cos{\left (\theta  \right )} \boldsymbol{e}_{2} + \left ( \sin{\left (\alpha  \right )} \cos{\left (\psi  \right )} \cos{\left (\theta  \right )} - \sin{\left (\theta  \right )} \cos{\left (\alpha  \right )}\right ) \boldsymbol{e}_{3} \nonumber \\
            n_2 &amp;= - \sin{\left (\psi  \right )} \cos{\left (\alpha  \right )} \boldsymbol{e}_{1} + \cos{\left (\psi  \right )} \boldsymbol{e}_{2} - \sin{\left (\alpha  \right )} \sin{\left (\psi  \right )} \boldsymbol{e}_{3} \nonumber \\
            n_3 &amp;= \left ( - \sin{\left (\alpha  \right )} \cos{\left (\theta  \right )} + \sin{\left (\theta  \right )} \cos{\left (\alpha  \right )} \cos{\left (\psi  \right )}\right ) \boldsymbol{e}_{1} + \sin{\left (\psi  \right )} \sin{\left (\theta  \right )} \boldsymbol{e}_{2} + \left ( \sin{\left (\alpha  \right )} \sin{\left (\theta  \right )} \cos{\left (\psi  \right )} + \cos{\left (\alpha  \right )} \cos{\left (\theta  \right )}\right ) \boldsymbol{e}_{3} \nonumber
            \end{align}
            \]</div>
<p>Check that this basis is orthonormal. Geometric product of the <span class="arithmatex">\(\{n_i\}\)</span> should give the pseudoscalar <span class="arithmatex">\(I = e_1 \wedge e_2 \wedge e_3\)</span></p>
<div class="highlight"><pre><span></span><code><span class="n">n123</span> <span class="o">=</span> <span class="p">(</span><span class="n">n1</span><span class="o">*</span><span class="n">n2</span><span class="o">*</span><span class="n">n3</span><span class="p">)</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">n123</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">equals</span><span class="p">((</span><span class="n">e1</span><span class="o">*</span><span class="n">e2</span><span class="o">*</span><span class="n">e3</span><span class="p">)</span><span class="o">.</span><span class="n">obj</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">n123</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle  \boldsymbol{e}_{1}\wedge \boldsymbol{e}_{2}\wedge \boldsymbol{e}_{3}\]</div>
<h3 id="orbit-rotor-and-meridian-plane">Orbit Rotor and Meridian Plane</h3>
<p>Earth orbit rotor <span class="arithmatex">\(R_\sigma\)</span>, and vector parallel to rays of sunshine, <span class="arithmatex">\(s\)</span>.</p>
<div class="highlight"><pre><span></span><code><span class="n">s</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">e1</span><span class="o">^</span><span class="n">e2</span><span class="p">)</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">()</span>
<span class="n">print_eq</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
        \begin{equation}
            s = \cos{\left (\sigma  \right )} \boldsymbol{e}_{1} + \sin{\left (\sigma  \right )} \boldsymbol{e}_{2} \nonumber
        \end{equation}
        \]</div>
<p>The meridian plane, <span class="arithmatex">\(M\)</span>.</p>
<div class="highlight"><pre><span></span><code><span class="n">M</span> <span class="o">=</span> <span class="p">(</span><span class="n">n1</span><span class="o">^</span><span class="n">n3</span><span class="p">)</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">()</span>
<span class="n">print_eq</span><span class="p">(</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
        \begin{equation}
            M = \sin{\left (\alpha  \right )} \sin{\left (\psi  \right )} \boldsymbol{e}_{1}\wedge \boldsymbol{e}_{2} + \cos{\left (\psi  \right )} \boldsymbol{e}_{1}\wedge \boldsymbol{e}_{3} + \sin{\left (\psi  \right )} \cos{\left (\alpha  \right )} \boldsymbol{e}_{2}\wedge \boldsymbol{e}_{3} \nonumber
        \end{equation}
        \]</div>
<p>The noon line is the intersection of the sunshine vector <span class="arithmatex">\(s\)</span> and the meridian plane <span class="arithmatex">\(M\)</span>, which occurs where <span class="arithmatex">\(s \wedge M\)</span> vanishes.</p>
<div class="highlight"><pre><span></span><code><span class="n">display</span><span class="p">(</span> <span class="p">(</span><span class="n">s</span><span class="o">^</span><span class="n">M</span><span class="p">)</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">()</span> <span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle \left ( \sin{\left (\psi  \right )} \cos{\left (\alpha  \right )} \cos{\left (\sigma  \right )} - \sin{\left (\sigma  \right )} \cos{\left (\psi  \right )}\right ) \boldsymbol{e}_{1}\wedge \boldsymbol{e}_{2}\wedge \boldsymbol{e}_{3}\]</div>
<div class="highlight"><pre><span></span><code><span class="n">coeff</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="o">^</span><span class="n">M</span><span class="p">)</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">()</span><span class="o">.</span><span class="n">get_coefs</span><span class="p">(</span><span class="mi">3</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">soln</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">coeff</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">psi</span><span class="p">),</span> <span class="n">tan</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">psi</span><span class="p">)),</span> <span class="n">tan</span><span class="p">(</span><span class="n">psi</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">assert</span> <span class="n">soln</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">tan</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span><span class="o">/</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">))</span>
<span class="n">print_eq</span><span class="p">(</span> <span class="sa">r</span><span class="s2">&quot;\tan(\psi)&quot;</span><span class="p">,</span> <span class="n">soln</span> <span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
        \begin{equation}
            \tan(\psi) = \frac{\tan{\left (\sigma  \right )}}{\cos{\left (\alpha  \right )}} \nonumber
        \end{equation}
        \]</div>
<h3 id="dial-face-and-gnomon">Dial face and gnomon</h3>
<p>Define an orthonormal frame <span class="arithmatex">\(u_1, u_2, u_3\)</span> as the unevaluated version of <span class="arithmatex">\(n_1, n_2, n_3\)</span>.</p>
<p><img alt="" src="https://raw.githubusercontent.com/russellgoyder/sundial-latex/main/figs/DialFrame.png?token=GHSAT0AAAAAAB73Q3JNJN46TIEHP3QCWWGYZAWGADA" title="Frame embedded in the sundial's face." />.</p>
<div class="highlight"><pre><span></span><code><span class="n">G3u</span> <span class="o">=</span> <span class="n">Ga</span><span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">,</span> <span class="n">g</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">coords</span><span class="o">=</span><span class="n">coords</span><span class="p">)</span>

<span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">,</span> <span class="n">u3</span><span class="p">)</span> <span class="o">=</span> <span class="n">G3u</span><span class="o">.</span><span class="n">mv</span><span class="p">()</span>
<span class="n">U</span> <span class="o">=</span> <span class="n">u1</span><span class="o">^</span><span class="n">u2</span><span class="o">^</span><span class="n">u3</span>
<span class="n">display</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle  \boldsymbol{u}_{1}\wedge \boldsymbol{u}_{2}\wedge \boldsymbol{u}_{3}\]</div>
<p>Dial face expressed relative to <span class="arithmatex">\(u\)</span> basis: <span class="arithmatex">\(G_u\)</span>.</p>
<div class="highlight"><pre><span></span><code><span class="n">Gu</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">rotate</span><span class="p">(</span><span class="n">u1</span><span class="o">^</span><span class="n">u2</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">u1</span><span class="o">^</span><span class="n">u3</span><span class="p">),</span> <span class="n">d</span><span class="p">,</span> <span class="n">u1</span><span class="o">^</span><span class="n">u2</span><span class="p">)</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">()</span>
<span class="n">print_eq</span><span class="p">(</span> <span class="s2">&quot;G_u&quot;</span><span class="p">,</span> <span class="n">Gu</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
        \begin{equation}
            G_u = \cos{\left (i \right )} \boldsymbol{u}_{1}\wedge \boldsymbol{u}_{2} + \sin{\left (d \right )} \sin{\left (i \right )} \boldsymbol{u}_{1}\wedge \boldsymbol{u}_{3} - \sin{\left (i \right )} \cos{\left (d \right )} \boldsymbol{u}_{2}\wedge \boldsymbol{u}_{3} \nonumber
        \end{equation}
        \]</div>
<p>Frame embedded in dial face.</p>
<div class="highlight"><pre><span></span><code><span class="n">m1</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">rotate</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">u1</span><span class="o">^</span><span class="n">u3</span><span class="p">),</span> <span class="n">d</span><span class="p">,</span> <span class="n">u1</span><span class="o">^</span><span class="n">u2</span><span class="p">)</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">()</span>
<span class="n">m2</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">rotate</span><span class="p">(</span><span class="n">u2</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">u1</span><span class="o">^</span><span class="n">u3</span><span class="p">),</span> <span class="n">d</span><span class="p">,</span> <span class="n">u1</span><span class="o">^</span><span class="n">u2</span><span class="p">)</span>
<span class="n">m3</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">rotate</span><span class="p">(</span><span class="n">u3</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">u1</span><span class="o">^</span><span class="n">u3</span><span class="p">),</span> <span class="n">d</span><span class="p">,</span> <span class="n">u1</span><span class="o">^</span><span class="n">u2</span><span class="p">)</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">()</span>

<span class="n">print_3frame</span><span class="p">((</span><span class="n">m1</span><span class="p">,</span><span class="n">m2</span><span class="p">,</span><span class="n">m3</span><span class="p">),</span> <span class="s2">&quot;m&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
            \begin{align}
            m_1 &amp;= \cos{\left (d \right )} \cos{\left (i \right )} \boldsymbol{u}_{1} + \sin{\left (d \right )} \cos{\left (i \right )} \boldsymbol{u}_{2} + \sin{\left (i \right )} \boldsymbol{u}_{3} \nonumber \\
            m_2 &amp;= - \sin{\left (d \right )} \boldsymbol{u}_{1} + \cos{\left (d \right )} \boldsymbol{u}_{2} \nonumber \\
            m_3 &amp;= - \sin{\left (i \right )} \cos{\left (d \right )} \boldsymbol{u}_{1} - \sin{\left (d \right )} \sin{\left (i \right )} \boldsymbol{u}_{2} + \cos{\left (i \right )} \boldsymbol{u}_{3} \nonumber
            \end{align}
            \]</div>
<p>The gnomon expressed relative to the <span class="arithmatex">\(u\)</span> frame, <span class="arithmatex">\(g_u\)</span>.</p>
<p><img alt="" src="https://raw.githubusercontent.com/russellgoyder/sundial-latex/main/figs/Gnomon.png?token=GHSAT0AAAAAAB73Q3JNHJMDP6T55SWPTQFGZAWGBNA" title="The gnomon." />.</p>
<div class="highlight"><pre><span></span><code><span class="n">gu</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">rotate</span><span class="p">(</span><span class="n">u3</span><span class="p">,</span> <span class="n">iota</span><span class="p">,</span> <span class="n">u1</span><span class="o">^</span><span class="n">u3</span><span class="p">),</span> <span class="n">delta</span><span class="p">,</span> <span class="n">u1</span><span class="o">^</span><span class="n">u2</span><span class="p">)</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">()</span>

<span class="c1"># extra manipulation to display exactly as in paper</span>
<span class="n">print_eq</span><span class="p">(</span><span class="s2">&quot;g_u&quot;</span><span class="p">,</span> <span class="n">sp</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">(</span><span class="n">gu</span><span class="o">.</span><span class="n">obj</span><span class="p">),</span> <span class="o">-</span><span class="n">sin</span><span class="p">(</span><span class="n">iota</span><span class="p">)))</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
        \begin{equation}
            g_u = - \sin{\left (\iota  \right )} \left(\sin{\left (\delta  \right )} \boldsymbol{u}_{2} + \cos{\left (\delta  \right )} \boldsymbol{u}_{1}\right) + \cos{\left (\iota  \right )} \boldsymbol{u}_{3} \nonumber
        \end{equation}
        \]</div>
<p>Projected onto the fixed-stars basis, the gnomon is</p>
<div class="highlight"><pre><span></span><code><span class="n">g</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span> <span class="n">c</span><span class="o">*</span><span class="n">ni</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">ni</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">gu</span><span class="o">.</span><span class="n">get_coefs</span><span class="p">(</span><span class="mi">1</span><span class="p">),[</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">])])</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">()</span>

<span class="c1"># would like to use .Fmt(3) but having rendering issues</span>
<span class="k">def</span> <span class="nf">print_vec</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">vec</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">):</span>
    <span class="n">coeffs</span> <span class="o">=</span> <span class="n">vec</span><span class="o">.</span><span class="n">get_coefs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Math</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            \begin</span><span class="se">{{</span><span class="s1">align</span><span class="se">}}</span>
<span class="s1">            </span><span class="si">{</span><span class="n">lhs</span><span class="si">}</span><span class="s1"> &amp; = </span><span class="si">{</span><span class="n">latex</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="n">coeffs</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">symbol</span><span class="si">}</span><span class="s1">_1 \nonumber \\</span>
<span class="s1">            &amp; + </span><span class="si">{</span><span class="n">latex</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="n">coeffs</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">symbol</span><span class="si">}</span><span class="s1">_2 \nonumber \\</span>
<span class="s1">            &amp; + </span><span class="si">{</span><span class="n">latex</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="n">coeffs</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">symbol</span><span class="si">}</span><span class="s1">_3 \nonumber</span>
<span class="s1">            \end</span><span class="se">{{</span><span class="s1">align</span><span class="se">}}</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="p">)</span>

<span class="n">print_vec</span><span class="p">(</span><span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
            \begin{align}
            g &amp; = - \sin{\left (\alpha  \right )} \sin{\left (\iota  \right )} \sin{\left (\theta  \right )} \cos{\left (\delta  \right )} - \sin{\left (\alpha  \right )} \cos{\left (\iota  \right )} \cos{\left (\theta  \right )} + \sin{\left (\delta  \right )} \sin{\left (\iota  \right )} \sin{\left (\psi  \right )} \cos{\left (\alpha  \right )} - \sin{\left (\iota  \right )} \cos{\left (\alpha  \right )} \cos{\left (\delta  \right )} \cos{\left (\psi  \right )} \cos{\left (\theta  \right )} + \sin{\left (\theta  \right )} \cos{\left (\alpha  \right )} \cos{\left (\iota  \right )} \cos{\left (\psi  \right )} e_1 \nonumber \\
            &amp; + - \sin{\left (\delta  \right )} \sin{\left (\iota  \right )} \cos{\left (\psi  \right )} - \sin{\left (\iota  \right )} \sin{\left (\psi  \right )} \cos{\left (\delta  \right )} \cos{\left (\theta  \right )} + \sin{\left (\psi  \right )} \sin{\left (\theta  \right )} \cos{\left (\iota  \right )} e_2 \nonumber \\
            &amp; + \sin{\left (\alpha  \right )} \sin{\left (\delta  \right )} \sin{\left (\iota  \right )} \sin{\left (\psi  \right )} - \sin{\left (\alpha  \right )} \sin{\left (\iota  \right )} \cos{\left (\delta  \right )} \cos{\left (\psi  \right )} \cos{\left (\theta  \right )} + \sin{\left (\alpha  \right )} \sin{\left (\theta  \right )} \cos{\left (\iota  \right )} \cos{\left (\psi  \right )} + \sin{\left (\iota  \right )} \sin{\left (\theta  \right )} \cos{\left (\alpha  \right )} \cos{\left (\delta  \right )} + \cos{\left (\alpha  \right )} \cos{\left (\iota  \right )} \cos{\left (\theta  \right )} e_3 \nonumber
            \end{align}
            \]</div>
<p>The gnomon lies in the meridian plane when the following trivector vanishes:</p>
<div class="highlight"><pre><span></span><code><span class="n">M_wedge_g</span> <span class="o">=</span> <span class="n">M</span><span class="o">^</span><span class="n">g</span>
<span class="k">assert</span> <span class="n">M_wedge_g</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">()</span><span class="o">.</span><span class="n">equals</span><span class="p">((</span><span class="n">sin</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">iota</span><span class="p">)</span><span class="o">*</span><span class="n">e1</span><span class="o">^</span><span class="n">e2</span><span class="o">^</span><span class="n">e3</span><span class="p">)</span><span class="o">.</span><span class="n">obj</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span> <span class="n">M_wedge_g</span> <span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle \sin{\left (\delta  \right )} \sin{\left (\iota  \right )} \boldsymbol{e}_{1}\wedge \boldsymbol{e}_{2}\wedge \boldsymbol{e}_{3}\]</div>
<p>Will also want <span class="arithmatex">\(s\)</span> on the <span class="arithmatex">\(n\)</span> frame</p>
<div class="highlight"><pre><span></span><code><span class="n">coeffs</span> <span class="o">=</span> <span class="p">[</span><span class="n">sp</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">((</span><span class="n">s</span><span class="o">|</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">obj</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">]]</span>
<span class="n">su</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">coeff</span><span class="o">*</span><span class="n">vec</span> <span class="k">for</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">vec</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">coeffs</span><span class="p">,</span> <span class="p">[</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">,</span> <span class="n">u3</span><span class="p">])])</span>
<span class="n">print_vec</span><span class="p">(</span><span class="s2">&quot;s_u&quot;</span><span class="p">,</span> <span class="n">su</span><span class="p">,</span> <span class="s2">&quot;u&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
            \begin{align}
            s_u &amp; = \sin{\left (\alpha  \right )} \sin{\left (\theta  \right )} \cos{\left (\sigma  \right )} + \sin{\left (\psi  \right )} \sin{\left (\sigma  \right )} \cos{\left (\theta  \right )} + \cos{\left (\alpha  \right )} \cos{\left (\psi  \right )} \cos{\left (\sigma  \right )} \cos{\left (\theta  \right )} u_1 \nonumber \\
            &amp; + - \sin{\left (\psi  \right )} \cos{\left (\alpha  \right )} \cos{\left (\sigma  \right )} + \sin{\left (\sigma  \right )} \cos{\left (\psi  \right )} u_2 \nonumber \\
            &amp; + - \sin{\left (\alpha  \right )} \cos{\left (\sigma  \right )} \cos{\left (\theta  \right )} + \sin{\left (\psi  \right )} \sin{\left (\sigma  \right )} \sin{\left (\theta  \right )} + \sin{\left (\theta  \right )} \cos{\left (\alpha  \right )} \cos{\left (\psi  \right )} \cos{\left (\sigma  \right )} u_3 \nonumber
            \end{align}
            \]</div>
<h2 id="the-calculation">The Calculation</h2>
<p>The calculation proceeds by defining <span class="arithmatex">\(S = s \wedge g\)</span>, the plane containing the sunshine vector and the gnomon. Its magnitude is the (negative) cosine of the angle bewteen <span class="arithmatex">\(s\)</span> and <span class="arithmatex">\(g\)</span>. Then we can obtain a generalized solar hour angle <span class="arithmatex">\(\mu\)</span> as the angle between <span class="arithmatex">\(S\)</span> and <span class="arithmatex">\(M\)</span>, given by</p>
<div class="arithmatex">\[\cos(\mu) = \frac{-S\cdot M}{\sqrt{-S^2}\sqrt{-M^2}} = \frac{-S\cdot M}{\sin(\Xi)}\]</div>
<p>given that <span class="arithmatex">\(M^2=-1\)</span>. In anticipation of setting <span class="arithmatex">\(\delta =0\)</span>, I will apply <span class="arithmatex">\(\delta\)</span> as a subscript to these quantities for now.</p>
<div class="highlight"><pre><span></span><code><span class="n">S_delta</span> <span class="o">=</span> <span class="n">s</span><span class="o">^</span><span class="n">g</span>

<span class="k">def</span> <span class="nf">print_bivec</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">bivec</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;e&quot;</span><span class="p">):</span>
    <span class="n">coeffs</span> <span class="o">=</span> <span class="n">bivec</span><span class="o">.</span><span class="n">get_coefs</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Math</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            \begin</span><span class="se">{{</span><span class="s1">align</span><span class="se">}}</span>
<span class="s1">            </span><span class="si">{</span><span class="n">lhs</span><span class="si">}</span><span class="s1"> &amp; = </span><span class="si">{</span><span class="n">latex</span><span class="p">(</span><span class="n">coeffs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">symbol</span><span class="si">}</span><span class="s1">_1 \wedge </span><span class="si">{</span><span class="n">symbol</span><span class="si">}</span><span class="s1">_2 \nonumber \\</span>
<span class="s1">            &amp; + </span><span class="si">{</span><span class="n">latex</span><span class="p">(</span><span class="n">coeffs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">symbol</span><span class="si">}</span><span class="s1">_1 \wedge </span><span class="si">{</span><span class="n">symbol</span><span class="si">}</span><span class="s1">_3 \nonumber \\</span>
<span class="s1">            &amp; + </span><span class="si">{</span><span class="n">latex</span><span class="p">(</span><span class="n">coeffs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">symbol</span><span class="si">}</span><span class="s1">_2 \wedge </span><span class="si">{</span><span class="n">symbol</span><span class="si">}</span><span class="s1">_3 \nonumber</span>
<span class="s1">            \end</span><span class="se">{{</span><span class="s1">align</span><span class="se">}}</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="p">)</span>

<span class="n">print_bivec</span><span class="p">(</span><span class="s2">&quot;S_\delta&quot;</span><span class="p">,</span> <span class="n">S_delta</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
            \begin{align}
            S_\delta &amp; = \sin{\left (\alpha  \right )} \sin{\left (\iota  \right )} \sin{\left (\sigma  \right )} \sin{\left (\theta  \right )} \cos{\left (\delta  \right )} + \sin{\left (\alpha  \right )} \sin{\left (\sigma  \right )} \cos{\left (\iota  \right )} \cos{\left (\theta  \right )} - \sin{\left (\delta  \right )} \sin{\left (\iota  \right )} \sin{\left (\psi  \right )} \sin{\left (\sigma  \right )} \cos{\left (\alpha  \right )} - \sin{\left (\delta  \right )} \sin{\left (\iota  \right )} \cos{\left (\psi  \right )} \cos{\left (\sigma  \right )} - \sin{\left (\iota  \right )} \sin{\left (\psi  \right )} \cos{\left (\delta  \right )} \cos{\left (\sigma  \right )} \cos{\left (\theta  \right )} + \sin{\left (\iota  \right )} \sin{\left (\sigma  \right )} \cos{\left (\alpha  \right )} \cos{\left (\delta  \right )} \cos{\left (\psi  \right )} \cos{\left (\theta  \right )} + \sin{\left (\psi  \right )} \sin{\left (\theta  \right )} \cos{\left (\iota  \right )} \cos{\left (\sigma  \right )} - \sin{\left (\sigma  \right )} \sin{\left (\theta  \right )} \cos{\left (\alpha  \right )} \cos{\left (\iota  \right )} \cos{\left (\psi  \right )} e_1 \wedge e_2 \nonumber \\
            &amp; + \sin{\left (\alpha  \right )} \sin{\left (\delta  \right )} \sin{\left (\iota  \right )} \sin{\left (\psi  \right )} \cos{\left (\sigma  \right )} - \sin{\left (\alpha  \right )} \sin{\left (\iota  \right )} \cos{\left (\delta  \right )} \cos{\left (\psi  \right )} \cos{\left (\sigma  \right )} \cos{\left (\theta  \right )} + \sin{\left (\alpha  \right )} \sin{\left (\theta  \right )} \cos{\left (\iota  \right )} \cos{\left (\psi  \right )} \cos{\left (\sigma  \right )} + \sin{\left (\iota  \right )} \sin{\left (\theta  \right )} \cos{\left (\alpha  \right )} \cos{\left (\delta  \right )} \cos{\left (\sigma  \right )} + \cos{\left (\alpha  \right )} \cos{\left (\iota  \right )} \cos{\left (\sigma  \right )} \cos{\left (\theta  \right )} e_1 \wedge e_3 \nonumber \\
            &amp; + \sin{\left (\alpha  \right )} \sin{\left (\delta  \right )} \sin{\left (\iota  \right )} \sin{\left (\psi  \right )} \sin{\left (\sigma  \right )} - \sin{\left (\alpha  \right )} \sin{\left (\iota  \right )} \sin{\left (\sigma  \right )} \cos{\left (\delta  \right )} \cos{\left (\psi  \right )} \cos{\left (\theta  \right )} + \sin{\left (\alpha  \right )} \sin{\left (\sigma  \right )} \sin{\left (\theta  \right )} \cos{\left (\iota  \right )} \cos{\left (\psi  \right )} + \sin{\left (\iota  \right )} \sin{\left (\sigma  \right )} \sin{\left (\theta  \right )} \cos{\left (\alpha  \right )} \cos{\left (\delta  \right )} + \sin{\left (\sigma  \right )} \cos{\left (\alpha  \right )} \cos{\left (\iota  \right )} \cos{\left (\theta  \right )} e_2 \wedge e_3 \nonumber
            \end{align}
            \]</div>
<p>Angle <span class="arithmatex">\(\Xi\)</span> between sun ray and gnomon:</p>
<div class="highlight"><pre><span></span><code><span class="n">cosXi_delta</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">((</span><span class="n">s</span><span class="o">|</span><span class="n">g</span><span class="p">)</span><span class="o">.</span><span class="n">obj</span><span class="p">)</span>
<span class="n">print_eq</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\cos(\Xi_\delta)&quot;</span><span class="p">,</span> <span class="n">cosXi_delta</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
        \begin{equation}
            \cos(\Xi_\delta) = \left(- \sin{\left (\delta  \right )} \sin{\left (\iota  \right )} \cos{\left (\psi  \right )} - \sin{\left (\iota  \right )} \sin{\left (\psi  \right )} \cos{\left (\delta  \right )} \cos{\left (\theta  \right )} + \sin{\left (\psi  \right )} \sin{\left (\theta  \right )} \cos{\left (\iota  \right )}\right) \sin{\left (\sigma  \right )} + \left(- \sin{\left (\alpha  \right )} \sin{\left (\iota  \right )} \sin{\left (\theta  \right )} \cos{\left (\delta  \right )} - \sin{\left (\alpha  \right )} \cos{\left (\iota  \right )} \cos{\left (\theta  \right )} + \sin{\left (\delta  \right )} \sin{\left (\iota  \right )} \sin{\left (\psi  \right )} \cos{\left (\alpha  \right )} - \sin{\left (\iota  \right )} \cos{\left (\alpha  \right )} \cos{\left (\delta  \right )} \cos{\left (\psi  \right )} \cos{\left (\theta  \right )} + \sin{\left (\theta  \right )} \cos{\left (\alpha  \right )} \cos{\left (\iota  \right )} \cos{\left (\psi  \right )}\right) \cos{\left (\sigma  \right )} \nonumber
        \end{equation}
        \]</div>
<p>Hour angle <span class="arithmatex">\(\mu\)</span>:</p>
<div class="highlight"><pre><span></span><code><span class="n">sinXi_cos_mu_delta</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">S_delta</span><span class="o">|</span><span class="n">M</span><span class="p">)</span><span class="o">.</span><span class="n">obj</span><span class="p">)</span>

<span class="n">print_eq</span><span class="p">(</span> <span class="sa">r</span><span class="s2">&quot;\sin(\Xi_\delta) \cos(\mu_\delta)&quot;</span><span class="p">,</span> <span class="n">sinXi_cos_mu_delta</span> <span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
        \begin{equation}
            \sin(\Xi_\delta) \cos(\mu_\delta) = - \sin{\left (\alpha  \right )} \sin{\left (\iota  \right )} \cos{\left (\delta  \right )} \cos{\left (\sigma  \right )} \cos{\left (\theta  \right )} + \sin{\left (\alpha  \right )} \sin{\left (\theta  \right )} \cos{\left (\iota  \right )} \cos{\left (\sigma  \right )} + \sin{\left (\iota  \right )} \sin{\left (\psi  \right )} \sin{\left (\sigma  \right )} \sin{\left (\theta  \right )} \cos{\left (\delta  \right )} + \sin{\left (\iota  \right )} \sin{\left (\theta  \right )} \cos{\left (\alpha  \right )} \cos{\left (\delta  \right )} \cos{\left (\psi  \right )} \cos{\left (\sigma  \right )} + \sin{\left (\psi  \right )} \sin{\left (\sigma  \right )} \cos{\left (\iota  \right )} \cos{\left (\theta  \right )} + \cos{\left (\alpha  \right )} \cos{\left (\iota  \right )} \cos{\left (\psi  \right )} \cos{\left (\sigma  \right )} \cos{\left (\theta  \right )} \nonumber
        \end{equation}
        \]</div>
<h3 id="a-simplifying-assumption">A Simplifying Assumption</h3>
<p>While <span class="arithmatex">\(\sin(\Xi)\cos(\mu)\)</span> is available in closed form, I have not been able to factorize <span class="arithmatex">\(\sin(\Xi)\sin(\mu) = \sqrt{1-\sin^2(\Xi)\cos^2(\mu)}\)</span>. While we can always proceed numerically, there is a nice factorization available in the case where the gnomon's declination angle <span class="arithmatex">\(\delta\)</span> is zero, so that it remains in the <span class="arithmatex">\(n_1 \wedge n_3\)</span> plane, so I will work in that case from here.</p>
<div class="highlight"><pre><span></span><code><span class="n">gu_delta</span> <span class="o">=</span> <span class="n">gu</span>
<span class="n">gu</span> <span class="o">=</span> <span class="n">gu</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">print_eq</span><span class="p">(</span> <span class="s2">&quot;g_u&quot;</span><span class="p">,</span> <span class="n">gu</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
        \begin{equation}
            g_u = - \sin{\left (\iota  \right )} \boldsymbol{u}_{1} + \cos{\left (\iota  \right )} \boldsymbol{u}_{3} \nonumber
        \end{equation}
        \]</div>
<div class="highlight"><pre><span></span><code><span class="n">g_delta</span> <span class="o">=</span> <span class="n">g</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">print_eq</span><span class="p">(</span> <span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
        \begin{equation}
            g = \left ( - \sin{\left (\alpha  \right )} \cos{\left (\iota  - \theta  \right )} - \sin{\left (\iota  - \theta  \right )} \cos{\left (\alpha  \right )} \cos{\left (\psi  \right )}\right ) \boldsymbol{e}_{1} - \sin{\left (\psi  \right )} \sin{\left (\iota  - \theta  \right )} \boldsymbol{e}_{2} + \left ( - \sin{\left (\alpha  \right )} \sin{\left (\iota  - \theta  \right )} \cos{\left (\psi  \right )} + \cos{\left (\alpha  \right )} \cos{\left (\iota  - \theta  \right )}\right ) \boldsymbol{e}_{3} \nonumber
        \end{equation}
        \]</div>
<p><code>g.obj</code> trails behind by one trigsimp</p>
<div class="highlight"><pre><span></span><code><span class="n">display</span><span class="p">(</span> <span class="n">g</span><span class="o">.</span><span class="n">obj</span> <span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle \left(- \sin{\left (\iota  \right )} \sin{\left (\psi  \right )} \cos{\left (\theta  \right )} + \sin{\left (\psi  \right )} \sin{\left (\theta  \right )} \cos{\left (\iota  \right )}\right) \boldsymbol{e}_{2} + \left(- \sin{\left (\alpha  \right )} \sin{\left (\iota  \right )} \sin{\left (\theta  \right )} - \sin{\left (\alpha  \right )} \cos{\left (\iota  \right )} \cos{\left (\theta  \right )} - \sin{\left (\iota  \right )} \cos{\left (\alpha  \right )} \cos{\left (\psi  \right )} \cos{\left (\theta  \right )} + \sin{\left (\theta  \right )} \cos{\left (\alpha  \right )} \cos{\left (\iota  \right )} \cos{\left (\psi  \right )}\right) \boldsymbol{e}_{1} + \left(- \sin{\left (\alpha  \right )} \sin{\left (\iota  \right )} \cos{\left (\psi  \right )} \cos{\left (\theta  \right )} + \sin{\left (\alpha  \right )} \sin{\left (\theta  \right )} \cos{\left (\iota  \right )} \cos{\left (\psi  \right )} + \sin{\left (\iota  \right )} \sin{\left (\theta  \right )} \cos{\left (\alpha  \right )} + \cos{\left (\alpha  \right )} \cos{\left (\iota  \right )} \cos{\left (\theta  \right )}\right) \boldsymbol{e}_{3}\]</div>
<p>Hack: ensure a healthy <code>g.obj</code> by reforming <span class="arithmatex">\(g\)</span> from the result of applying <code>sympy.trigsimp</code> to each component individually</p>
<div class="highlight"><pre><span></span><code><span class="n">g</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">sp</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">(</span><span class="n">coef</span><span class="p">)</span><span class="o">*</span><span class="n">vec</span> <span class="k">for</span> <span class="n">coef</span><span class="p">,</span> <span class="n">vec</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">get_coefs</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">G3</span><span class="o">.</span><span class="n">mv</span><span class="p">())])</span>
<span class="n">display</span><span class="p">(</span> <span class="n">g</span> <span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle \left ( - \sin{\left (\alpha  \right )} \cos{\left (\iota  - \theta  \right )} - \sin{\left (\iota  - \theta  \right )} \cos{\left (\alpha  \right )} \cos{\left (\psi  \right )}\right ) \boldsymbol{e}_{1} - \sin{\left (\psi  \right )} \sin{\left (\iota  - \theta  \right )} \boldsymbol{e}_{2} + \left ( - \sin{\left (\alpha  \right )} \sin{\left (\iota  - \theta  \right )} \cos{\left (\psi  \right )} + \cos{\left (\alpha  \right )} \cos{\left (\iota  - \theta  \right )}\right ) \boldsymbol{e}_{3}\]</div>
<div class="highlight"><pre><span></span><code><span class="c1"># eyeball check:</span>
<span class="n">display</span><span class="p">(</span> <span class="n">g</span><span class="o">.</span><span class="n">obj</span> <span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle - \sin{\left (\alpha  \right )} \sin{\left (\iota  - \theta  \right )} \cos{\left (\psi  \right )} \boldsymbol{e}_{3} - \sin{\left (\alpha  \right )} \cos{\left (\iota  - \theta  \right )} \boldsymbol{e}_{1} - \sin{\left (\psi  \right )} \sin{\left (\iota  - \theta  \right )} \boldsymbol{e}_{2} - \sin{\left (\iota  - \theta  \right )} \cos{\left (\alpha  \right )} \cos{\left (\psi  \right )} \boldsymbol{e}_{1} + \cos{\left (\alpha  \right )} \cos{\left (\iota  - \theta  \right )} \boldsymbol{e}_{3}\]</div>
<h3 id="the-shadow-plane">The Shadow Plane</h3>
<p>Setting <span class="arithmatex">\(\delta = 0\)</span> in the shadow plane <span class="arithmatex">\(S = s \wedge g\)</span> (the plane containing the sunshine vector and the gnomon) gives a more manageable expression.</p>
<div class="highlight"><pre><span></span><code><span class="n">S</span> <span class="o">=</span> <span class="n">s</span><span class="o">^</span><span class="n">g</span>

<span class="n">print_bivec</span><span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="n">S</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
            \begin{align}
            S &amp; = \sin{\left (\alpha  \right )} \sin{\left (\sigma  \right )} \cos{\left (\iota  - \theta  \right )} - \sin{\left (\psi  \right )} \sin{\left (\iota  - \theta  \right )} \cos{\left (\sigma  \right )} + \sin{\left (\sigma  \right )} \sin{\left (\iota  - \theta  \right )} \cos{\left (\alpha  \right )} \cos{\left (\psi  \right )} e_1 \wedge e_2 \nonumber \\
            &amp; + - \sin{\left (\alpha  \right )} \sin{\left (\iota  - \theta  \right )} \cos{\left (\psi  \right )} \cos{\left (\sigma  \right )} + \cos{\left (\alpha  \right )} \cos{\left (\sigma  \right )} \cos{\left (\iota  - \theta  \right )} e_1 \wedge e_3 \nonumber \\
            &amp; + - \sin{\left (\alpha  \right )} \sin{\left (\sigma  \right )} \sin{\left (\iota  - \theta  \right )} \cos{\left (\psi  \right )} + \sin{\left (\sigma  \right )} \cos{\left (\alpha  \right )} \cos{\left (\iota  - \theta  \right )} e_2 \wedge e_3 \nonumber
            \end{align}
            \]</div>
<p>Appl the <span class="arithmatex">\(\delta=0\)</span> assumption to the cosine of the angle <span class="arithmatex">\(\Xi\)</span> between sun ray and gnomon:</p>
<div class="highlight"><pre><span></span><code><span class="n">cosXi</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">((</span><span class="n">s</span><span class="o">|</span><span class="n">g</span><span class="p">)</span><span class="o">.</span><span class="n">obj</span><span class="p">)</span>
<span class="n">print_eq</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\cos(\Xi)&quot;</span><span class="p">,</span> <span class="n">cosXi</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
        \begin{equation}
            \cos(\Xi) = - \left(\sin{\left (\alpha  \right )} \cos{\left (\iota  - \theta  \right )} + \sin{\left (\iota  - \theta  \right )} \cos{\left (\alpha  \right )} \cos{\left (\psi  \right )}\right) \cos{\left (\sigma  \right )} - \sin{\left (\psi  \right )} \sin{\left (\sigma  \right )} \sin{\left (\iota  - \theta  \right )} \nonumber
        \end{equation}
        \]</div>
<p>Check <span class="arithmatex">\(S^2 = (s\wedge g)^2 = (s\cdot g)^2 - s^2 g^2\)</span> where <span class="arithmatex">\(s^2 = g^2 = 1\)</span>. </p>
<div class="highlight"><pre><span></span><code><span class="n">sg_squared</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="o">|</span><span class="n">g</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">s</span><span class="o">|</span><span class="n">g</span><span class="p">)</span>
<span class="n">S_norm_check</span> <span class="o">=</span> <span class="p">(</span><span class="n">S</span><span class="o">|</span><span class="n">S</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span> <span class="n">sg_squared</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">)</span>
<span class="k">assert</span> <span class="n">S_norm_check</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span> <span class="n">S_norm_check</span> <span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle  0 \]</div>
<p>The magnitude of <span class="arithmatex">\(S\)</span> is given by <span class="arithmatex">\(\sqrt{-S^2} = \sqrt{1 - (s\cdot g)^2} = \sqrt{1 - \cos^2(\Xi}) = \sin^2(\Xi)\)</span>:</p>
<div class="highlight"><pre><span></span><code><span class="n">sinXi</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">((</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">psi</span><span class="p">))</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">iota</span><span class="o">-</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">iota</span><span class="o">-</span><span class="n">theta</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
<span class="n">print_eq</span><span class="p">(</span><span class="s2">&quot;\sin(\Xi)&quot;</span><span class="p">,</span> <span class="n">sinXi</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
        \begin{equation}
            \sin(\Xi) = \sqrt{1 - \left(\left(\sin{\left (\psi  \right )} \sin{\left (\sigma  \right )} + \cos{\left (\alpha  \right )} \cos{\left (\psi  \right )} \cos{\left (\sigma  \right )}\right) \sin{\left (\iota  - \theta  \right )} + \sin{\left (\alpha  \right )} \cos{\left (\sigma  \right )} \cos{\left (\iota  - \theta  \right )}\right)^{2}} \nonumber
        \end{equation}
        \]</div>
<div class="highlight"><pre><span></span><code><span class="c1"># check</span>
<span class="n">sg_check</span> <span class="o">=</span> <span class="n">sinXi</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">sg_squared</span> <span class="p">)</span>
<span class="k">assert</span> <span class="n">sg_check</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span> <span class="n">sg_check</span> <span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle  0 \]</div>
<h3 id="the-hour-angle">The Hour Angle</h3>
<p>We can now calculate the generalized solar hour angle <span class="arithmatex">\(\mu\)</span> (the angle between <span class="arithmatex">\(S\)</span> and <span class="arithmatex">\(M\)</span>), given by <span class="arithmatex">\(\cos(\mu) = \frac{-S\cdot M}{\sin(\Xi)}\)</span> and also obtain a nice expression in closed form for <span class="arithmatex">\(\sin(\mu)\)</span>.</p>
<div class="highlight"><pre><span></span><code><span class="n">sinXi_cos_mu</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">S</span><span class="o">|</span><span class="n">M</span><span class="p">)</span><span class="o">.</span><span class="n">obj</span><span class="p">)</span>

<span class="n">print_eq</span><span class="p">(</span> <span class="sa">r</span><span class="s2">&quot;\sin(\Xi) \cos(\mu)&quot;</span><span class="p">,</span> <span class="n">sinXi_cos_mu</span> <span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
        \begin{equation}
            \sin(\Xi) \cos(\mu) = - \sin{\left (\alpha  \right )} \sin{\left (\iota  - \theta  \right )} \cos{\left (\sigma  \right )} + \sin{\left (\psi  \right )} \sin{\left (\sigma  \right )} \cos{\left (\iota  - \theta  \right )} + \cos{\left (\alpha  \right )} \cos{\left (\psi  \right )} \cos{\left (\sigma  \right )} \cos{\left (\iota  - \theta  \right )} \nonumber
        \end{equation}
        \]</div>
<p>From <span class="arithmatex">\(\sin^2\mu + \cos^2\mu = 1\)</span> (by hand), we have:</p>
<div class="highlight"><pre><span></span><code><span class="n">sinXi_sin_mu</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span>
<span class="n">print_eq</span><span class="p">(</span><span class="s2">&quot;\sin(\Xi) \sin(\mu)&quot;</span><span class="p">,</span> <span class="n">sinXi_sin_mu</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
        \begin{equation}
            \sin(\Xi) \sin(\mu) = \sin{\left (\psi  \right )} \cos{\left (\alpha  \right )} \cos{\left (\sigma  \right )} - \sin{\left (\sigma  \right )} \cos{\left (\psi  \right )} \nonumber
        \end{equation}
        \]</div>
<p>Check that <span class="arithmatex">\(\sin^2(\Xi)\sin^2(\mu) + \sin^2(\Xi)\cos^2(\mu) = \sin^2(\Xi)\)</span></p>
<div class="highlight"><pre><span></span><code><span class="n">Xi_check</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">(</span> <span class="n">sp</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">sinXi_sin_mu</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">sp</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">sinXi_cos_mu</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">sp</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">sinXi</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
<span class="k">assert</span> <span class="n">Xi_check</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span> <span class="n">Xi_check</span> <span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 0\]</div>
<p>The ratio gives <span class="arithmatex">\(\tan(\mu)\)</span> as in the paper:</p>
<div class="highlight"><pre><span></span><code><span class="n">mu_ratio</span> <span class="o">=</span> <span class="n">sinXi_sin_mu</span> <span class="o">/</span> <span class="n">sp</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="n">sinXi_cos_mu</span><span class="p">,</span> <span class="n">cos</span><span class="p">(</span><span class="n">iota</span><span class="o">-</span><span class="n">theta</span><span class="p">))</span>
<span class="n">print_eq</span><span class="p">(</span> <span class="sa">r</span><span class="s2">&quot;\tan(\mu)&quot;</span><span class="p">,</span> <span class="n">sp</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span> <span class="n">mu_ratio</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">sigma</span><span class="p">),</span> <span class="n">tan</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">sigma</span><span class="p">))</span> <span class="p">)</span> <span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
        \begin{equation}
            \tan(\mu) = \frac{\sin{\left (\psi  \right )} \cos{\left (\alpha  \right )} - \cos{\left (\psi  \right )} \tan{\left (\sigma  \right )}}{\left(\sin{\left (\psi  \right )} \tan{\left (\sigma  \right )} + \cos{\left (\alpha  \right )} \cos{\left (\psi  \right )}\right) \cos{\left (\iota  - \theta  \right )} - \sin{\left (\alpha  \right )} \sin{\left (\iota  - \theta  \right )}} \nonumber
        \end{equation}
        \]</div>
<p>Now express <span class="arithmatex">\(S\)</span> in terms of <span class="arithmatex">\(\mu\)</span> on the <span class="arithmatex">\(\{n\}\)</span> basis. First remind myself what <span class="arithmatex">\(S\)</span> looks like:</p>
<div class="highlight"><pre><span></span><code><span class="n">print_bivec</span><span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="n">S</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
            \begin{align}
            S &amp; = \sin{\left (\alpha  \right )} \sin{\left (\sigma  \right )} \cos{\left (\iota  - \theta  \right )} - \sin{\left (\psi  \right )} \sin{\left (\iota  - \theta  \right )} \cos{\left (\sigma  \right )} + \sin{\left (\sigma  \right )} \sin{\left (\iota  - \theta  \right )} \cos{\left (\alpha  \right )} \cos{\left (\psi  \right )} e_1 \wedge e_2 \nonumber \\
            &amp; + - \sin{\left (\alpha  \right )} \sin{\left (\iota  - \theta  \right )} \cos{\left (\psi  \right )} \cos{\left (\sigma  \right )} + \cos{\left (\alpha  \right )} \cos{\left (\sigma  \right )} \cos{\left (\iota  - \theta  \right )} e_1 \wedge e_3 \nonumber \\
            &amp; + - \sin{\left (\alpha  \right )} \sin{\left (\sigma  \right )} \sin{\left (\iota  - \theta  \right )} \cos{\left (\psi  \right )} + \sin{\left (\sigma  \right )} \cos{\left (\alpha  \right )} \cos{\left (\iota  - \theta  \right )} e_2 \wedge e_3 \nonumber
            \end{align}
            \]</div>
<p>and save nice forms of the <span class="arithmatex">\(n\)</span> bivectors</p>
<div class="highlight"><pre><span></span><code><span class="n">n12</span> <span class="o">=</span> <span class="n">mv</span><span class="o">.</span><span class="n">Mv</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">expand_trig</span><span class="p">((</span><span class="n">n1</span><span class="o">^</span><span class="n">n2</span><span class="p">)</span><span class="o">.</span><span class="n">obj</span><span class="p">)),</span> <span class="n">ga</span><span class="o">=</span><span class="n">G3</span><span class="p">)</span>
<span class="n">n13</span> <span class="o">=</span> <span class="n">mv</span><span class="o">.</span><span class="n">Mv</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">expand_trig</span><span class="p">((</span><span class="n">n1</span><span class="o">^</span><span class="n">n3</span><span class="p">)</span><span class="o">.</span><span class="n">obj</span><span class="p">)),</span> <span class="n">ga</span><span class="o">=</span><span class="n">G3</span><span class="p">)</span>
<span class="n">n23</span> <span class="o">=</span> <span class="n">mv</span><span class="o">.</span><span class="n">Mv</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">expand_trig</span><span class="p">((</span><span class="n">n2</span><span class="o">^</span><span class="n">n3</span><span class="p">)</span><span class="o">.</span><span class="n">obj</span><span class="p">)),</span> <span class="n">ga</span><span class="o">=</span><span class="n">G3</span><span class="p">)</span>
</code></pre></div>
<p>So now can check each component of S on the <span class="arithmatex">\(n\)</span> basis</p>
<div class="highlight"><pre><span></span><code><span class="n">Sn_check</span> <span class="o">=</span> <span class="p">(</span><span class="n">S</span><span class="o">|</span><span class="n">n12</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="n">sinXi_sin_mu</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">iota</span><span class="p">))</span> <span class="o">==</span> <span class="p">(</span><span class="n">S</span><span class="o">|</span><span class="n">n13</span><span class="p">)</span> <span class="o">+</span> <span class="n">sinXi_cos_mu</span> <span class="o">==</span> <span class="p">(</span><span class="n">S</span><span class="o">|</span><span class="n">n23</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="n">sinXi_sin_mu</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">iota</span><span class="p">))</span> <span class="o">==</span> <span class="n">mv</span><span class="o">.</span><span class="n">Mv</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ga</span><span class="o">=</span><span class="n">G3</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">Sn_check</span>
<span class="n">Sn_check</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>True
</code></pre></div>
<p>and confirm S in this form</p>
<div class="highlight"><pre><span></span><code><span class="n">S_check</span> <span class="o">=</span> <span class="n">S</span> <span class="o">-</span> <span class="p">(</span><span class="o">-</span><span class="n">sinXi_sin_mu</span><span class="o">*</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">iota</span><span class="p">)</span><span class="o">*</span><span class="n">n12</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">iota</span><span class="p">)</span><span class="o">*</span><span class="n">n23</span><span class="p">)</span> <span class="o">+</span> <span class="n">sinXi_cos_mu</span><span class="o">*</span><span class="n">n13</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">S_check</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span> <span class="n">S_check</span> <span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle  0 \]</div>
<p>so can capture S in terms of the surface-frame bivectors</p>
<div class="highlight"><pre><span></span><code><span class="n">Xi</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s2">&quot;\Xi&quot;</span><span class="p">)</span>
<span class="n">Su</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">Xi</span><span class="p">)</span><span class="o">*</span><span class="p">(</span> <span class="o">-</span><span class="n">sin</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">iota</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">u1</span><span class="o">^</span><span class="n">u2</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">iota</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">u2</span><span class="o">^</span><span class="n">u3</span><span class="p">))</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">u1</span><span class="o">^</span><span class="n">u3</span><span class="p">)</span> <span class="p">)</span>
<span class="n">print_eq</span><span class="p">(</span> <span class="s2">&quot;S_u&quot;</span><span class="p">,</span> <span class="n">Su</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
        \begin{equation}
            S_u = - \sin{\left (\Xi \right )} \sin{\left (\iota  \right )} \sin{\left (\mu  \right )} \boldsymbol{u}_{1}\wedge \boldsymbol{u}_{2} + \sin{\left (\Xi \right )} \cos{\left (\mu  \right )} \boldsymbol{u}_{1}\wedge \boldsymbol{u}_{3} - \sin{\left (\Xi \right )} \sin{\left (\mu  \right )} \cos{\left (\iota  \right )} \boldsymbol{u}_{2}\wedge \boldsymbol{u}_{3} \nonumber
        \end{equation}
        \]</div>
<p>Check that <span class="arithmatex">\(S_u\)</span> and <span class="arithmatex">\(S\)</span> are really the same thing</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">e_frame</span><span class="p">(</span><span class="n">bvec</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Take a bivector in the GA defined by the surface frame n1, n2, n3 (written as u1, u2, u3)</span>
<span class="sd">    and express it in the GA defined by the frame of the fixed stars, e1, e2, e3</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">coeffs</span> <span class="o">=</span> <span class="n">bvec</span><span class="o">.</span><span class="n">get_coefs</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">coeffs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">n12</span> <span class="o">+</span> <span class="n">coeffs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">n13</span> <span class="o">+</span> <span class="n">coeffs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">n23</span>

<span class="n">Su_check</span> <span class="o">=</span> <span class="n">e_frame</span><span class="p">(</span><span class="n">Su</span><span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">mu</span><span class="p">),</span> <span class="n">sinXi_sin_mu</span><span class="o">/</span><span class="n">sin</span><span class="p">(</span><span class="n">Xi</span><span class="p">))</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">mu</span><span class="p">),</span> <span class="n">sinXi_cos_mu</span><span class="o">/</span><span class="n">sin</span><span class="p">(</span><span class="n">Xi</span><span class="p">))</span> <span class="o">-</span> <span class="n">S</span>
<span class="k">assert</span> <span class="n">Su_check</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span> <span class="n">Su_check</span> <span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle  0 \]</div>
<h3 id="the-shadow-angle">The Shadow Angle</h3>
<p>Form a vector parallel to the shadow, as the intersection between <span class="arithmatex">\(S\)</span> (the plane containing the sun ray and the gnomon) and <span class="arithmatex">\(G\)</span> (the dial face)</p>
<div class="highlight"><pre><span></span><code><span class="n">u</span> <span class="o">=</span> <span class="p">((</span><span class="n">u1</span><span class="o">^</span><span class="n">u2</span><span class="o">^</span><span class="n">u3</span><span class="p">)</span> <span class="o">*</span> <span class="n">Gu</span> <span class="o">*</span> <span class="n">Su</span><span class="p">)</span><span class="o">.</span><span class="n">get_grade</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">()</span>
<span class="n">print_vec</span><span class="p">(</span><span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="s2">&quot;u&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
            \begin{align}
            u &amp; = \sin{\left (\Xi \right )} \sin{\left (d \right )} \sin{\left (i \right )} \sin{\left (\iota  \right )} \sin{\left (\mu  \right )} + \sin{\left (\Xi \right )} \cos{\left (i \right )} \cos{\left (\mu  \right )} u_1 \nonumber \\
            &amp; + - \sin{\left (\Xi \right )} \sin{\left (i \right )} \sin{\left (\iota  \right )} \sin{\left (\mu  \right )} \cos{\left (d \right )} - \sin{\left (\Xi \right )} \sin{\left (\mu  \right )} \cos{\left (i \right )} \cos{\left (\iota  \right )} u_2 \nonumber \\
            &amp; + - \sin{\left (\Xi \right )} \sin{\left (d \right )} \sin{\left (i \right )} \sin{\left (\mu  \right )} \cos{\left (\iota  \right )} + \sin{\left (\Xi \right )} \sin{\left (i \right )} \cos{\left (d \right )} \cos{\left (\mu  \right )} u_3 \nonumber
            \end{align}
            \]</div>
<p>Want to normalize <span class="arithmatex">\(u\)</span> to get <span class="arithmatex">\(\hat{u} \equiv \hat{w}\)</span>, a unit vector parallel to the shadow <span class="arithmatex">\(w\)</span>. Can square and add the above components, but there is a route to a simpler expression as follows.</p>
<p>The cosine of the angle between the "shadow plane" <span class="arithmatex">\(S\)</span> (containing the sun ray <span class="arithmatex">\(s\)</span> and the gnomon <span class="arithmatex">\(g\)</span>) and dial face <span class="arithmatex">\(G\)</span> is given by</p>
<div class="arithmatex">\[\cos(\Psi) = \frac{S\cdot G}{\sqrt{-S^2}\sqrt{-G^2}}\]</div>
<p>Given that <span class="arithmatex">\(S^2 = -\sin^2(\Xi)\)</span> and <span class="arithmatex">\(G^2 = -1\)</span>,</p>
<div class="arithmatex">\[ \cos(\Psi) = \frac{S\cdot G}{\sin(\Xi)}\]</div>
<div class="highlight"><pre><span></span><code><span class="n">cosPsi</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">(((</span><span class="n">Su</span><span class="o">|</span><span class="n">Gu</span><span class="p">)</span><span class="o">/</span><span class="n">sin</span><span class="p">(</span><span class="n">Xi</span><span class="p">))</span><span class="o">.</span><span class="n">obj</span><span class="p">)</span>
<span class="n">print_eq</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\cos(\Psi)&quot;</span><span class="p">,</span> <span class="n">cosPsi</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
        \begin{equation}
            \cos(\Psi) = - \sin{\left (d \right )} \sin{\left (i \right )} \cos{\left (\mu  \right )} - \sin{\left (i \right )} \sin{\left (\mu  \right )} \cos{\left (d \right )} \cos{\left (\iota  \right )} + \sin{\left (\iota  \right )} \sin{\left (\mu  \right )} \cos{\left (i \right )} \nonumber
        \end{equation}
        \]</div>
<div class="highlight"><pre><span></span><code><span class="c1"># check (force sympy to give up the positive square root in each factor in the denominator)</span>
<span class="n">SuGu_check</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">((</span><span class="n">Su</span><span class="o">|</span><span class="n">Gu</span><span class="p">)</span><span class="o">.</span><span class="n">obj</span><span class="p">)</span> \
<span class="o">/</span> <span class="n">sp</span><span class="o">.</span><span class="n">powdenest</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">((</span><span class="o">-</span><span class="n">Su</span><span class="o">|</span><span class="n">Su</span><span class="p">)</span><span class="o">.</span><span class="n">obj</span><span class="p">)),</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> \
<span class="o">/</span> <span class="n">sp</span><span class="o">.</span><span class="n">powdenest</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">((</span><span class="o">-</span><span class="n">Gu</span><span class="o">|</span><span class="n">Gu</span><span class="p">)</span><span class="o">.</span><span class="n">obj</span><span class="p">)),</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> \
<span class="o">-</span> <span class="p">((</span><span class="n">Su</span><span class="o">|</span><span class="n">Gu</span><span class="p">)</span><span class="o">/</span><span class="n">sin</span><span class="p">(</span><span class="n">Xi</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">SuGu_check</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span> <span class="n">SuGu_check</span> <span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle  0 \]</div>
<p>Now, the length of <span class="arithmatex">\(u\)</span> is related to <span class="arithmatex">\(\Psi\)</span> as follows.</p>
<div class="arithmatex">\[u^2 = (I\; G \times S)^2 = (\frac{I}{2}(GS-SG))^2 = -\frac{1}{4}(GSGS+SGSG-2S^2G^2)\]</div>
<p>But</p>
<div class="arithmatex">\[(S\cdot G)^2 = \frac{1}{4}(SG+GS)^2 = \frac{1}{4}(SGSG+GSGS+2S^2G^2)\]</div>
<p>So,</p>
<div class="arithmatex">\[u^2 = S^2G^2 - (S\cdot G)^2 = \sin^2(\Xi) - (S\cdot G)^2 = \sin^2(\Xi)\sin^2(\Psi)\]</div>
<div class="highlight"><pre><span></span><code><span class="c1"># check</span>
<span class="n">u2_check</span> <span class="o">=</span> <span class="p">(</span><span class="n">u</span><span class="o">|</span><span class="n">u</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">Xi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">Su</span><span class="o">|</span><span class="n">Gu</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">u2_check</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span> <span class="n">u2_check</span> <span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle  0 \]</div>
<p>We can now form <span class="arithmatex">\(\hat{w}\)</span> by dividing <span class="arithmatex">\(u\)</span> by its length</p>
<div class="highlight"><pre><span></span><code><span class="n">Psi</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s2">&quot;\Psi&quot;</span><span class="p">)</span>
<span class="n">what</span> <span class="o">=</span> <span class="n">u</span><span class="o">/</span><span class="n">sin</span><span class="p">(</span><span class="n">Xi</span><span class="p">)</span><span class="o">/</span><span class="n">sin</span><span class="p">(</span><span class="n">Psi</span><span class="p">)</span>

<span class="n">print_vec</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\hat</span><span class="si">{w}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">what</span><span class="p">,</span> <span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="n">sp</span><span class="o">.</span><span class="n">factor</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
            \begin{align}
            \hat{w} &amp; = \frac{\sin{\left (d \right )} \sin{\left (i \right )} \sin{\left (\iota  \right )} \sin{\left (\mu  \right )} + \cos{\left (i \right )} \cos{\left (\mu  \right )}}{\sin{\left (\Psi \right )}} u_1 \nonumber \\
            &amp; + - \frac{\left(\sin{\left (i \right )} \sin{\left (\iota  \right )} \cos{\left (d \right )} + \cos{\left (i \right )} \cos{\left (\iota  \right )}\right) \sin{\left (\mu  \right )}}{\sin{\left (\Psi \right )}} u_2 \nonumber \\
            &amp; + \frac{\left(- \sin{\left (d \right )} \sin{\left (\mu  \right )} \cos{\left (\iota  \right )} + \cos{\left (d \right )} \cos{\left (\mu  \right )}\right) \sin{\left (i \right )}}{\sin{\left (\Psi \right )}} u_3 \nonumber
            \end{align}
            \]</div>
<p>Check that</p>
<div class="arithmatex">\[\hat{w}^2 = \left(\frac{u}{\sin(\Xi)\sin(\Psi)}\right)^2 = 1\]</div>
<p>by showing that</p>
<div class="arithmatex">\[\frac{u^2}{\sin^2(\Xi)} - \sin^2\Psi = 0\]</div>
<div class="highlight"><pre><span></span><code><span class="n">sinPsiSquared</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">sp</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">cosPsi</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">u_over_sinXi_squared</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">(((</span><span class="n">u</span><span class="o">|</span><span class="n">u</span><span class="p">)</span><span class="o">/</span><span class="n">sin</span><span class="p">(</span><span class="n">Xi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">obj</span><span class="p">)</span>
<span class="n">what_check</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">(</span><span class="n">u_over_sinXi_squared</span> <span class="o">-</span> <span class="n">sinPsiSquared</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">what_check</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span> <span class="n">what_check</span> <span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 0\]</div>
<p>Get the angular coordinate of the shadow tip relative to noon, call it <span class="arithmatex">\(\zeta\)</span>. At noon we have <span class="arithmatex">\(\mu = 0\)</span></p>
<div class="highlight"><pre><span></span><code><span class="n">sinPsi_noon</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">cosPsi</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span> <span class="n">sinPsi_noon</span> <span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle \sqrt{- {\sin{\left (d \right )}}^{2} {\sin{\left (i \right )}}^{2} + 1}\]</div>
<div class="highlight"><pre><span></span><code><span class="n">noon</span> <span class="o">=</span> <span class="n">what</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">Psi</span><span class="p">),</span><span class="n">sinPsi_noon</span><span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span> <span class="n">noon</span> <span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle \frac{\cos{\left (i \right )}}{\sqrt{- {\sin{\left (d \right )}}^{2} {\sin{\left (i \right )}}^{2} + 1}} \boldsymbol{u}_{1} + \frac{\sin{\left (i \right )} \cos{\left (d \right )}}{\sqrt{- {\sin{\left (d \right )}}^{2} {\sin{\left (i \right )}}^{2} + 1}} \boldsymbol{u}_{3}\]</div>
<p>So <span class="arithmatex">\(\cos(\zeta) = \hat{w}(\mu) \cdot \hat{w}(0)\)</span></p>
<div class="highlight"><pre><span></span><code><span class="n">cos_zeta</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">((</span><span class="n">what</span><span class="o">|</span><span class="n">noon</span><span class="p">)</span><span class="o">.</span><span class="n">obj</span><span class="p">),</span><span class="n">sin</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">d</span><span class="p">)),</span><span class="n">cos</span><span class="p">(</span><span class="n">mu</span><span class="p">))</span>
<span class="n">print_eq</span><span class="p">(</span> <span class="sa">r</span><span class="s2">&quot;\cos(\zeta)&quot;</span><span class="p">,</span> <span class="n">cos_zeta</span> <span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
        \begin{equation}
            \cos(\zeta) = \frac{\left(- {\sin{\left (d \right )}}^{2} {\sin{\left (i \right )}}^{2} + 1\right) \cos{\left (\mu  \right )} + \left(- \sin{\left (i \right )} \cos{\left (d \right )} \cos{\left (\iota  \right )} + \sin{\left (\iota  \right )} \cos{\left (i \right )}\right) \sin{\left (d \right )} \sin{\left (i \right )} \sin{\left (\mu  \right )}}{\sqrt{- {\sin{\left (d \right )}}^{2} {\sin{\left (i \right )}}^{2} + 1} \sin{\left (\Psi \right )}} \nonumber
        \end{equation}
        \]</div>
<p>And easiest route to <span class="arithmatex">\(\sin(\zeta)\)</span> is to use the fact that the shadow lives in the plane of the dial face, so <span class="arithmatex">\(\hat{w}(\mu) \wedge \hat{w}(0) = \sin(\zeta) G\)</span></p>
<div class="highlight"><pre><span></span><code><span class="n">sin_zeta</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">what</span> <span class="o">^</span> <span class="n">noon</span><span class="p">)</span> <span class="o">|</span> <span class="n">Gu</span>
<span class="n">print_eq</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\sin(\zeta)&quot;</span><span class="p">,</span> <span class="n">sin_zeta</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
        \begin{equation}
            \sin(\zeta) = \frac{\left(\sin{\left (i \right )} \sin{\left (\iota  \right )} \cos{\left (d \right )} + \cos{\left (i \right )} \cos{\left (\iota  \right )}\right) \sin{\left (\mu  \right )}}{\sqrt{- {\sin{\left (d \right )}}^{2} {\sin{\left (i \right )}}^{2} + 1} \sin{\left (\Psi \right )}} \nonumber
        \end{equation}
        \]</div>
<div class="highlight"><pre><span></span><code><span class="n">tan_zeta</span> <span class="o">=</span> <span class="p">(</span><span class="n">sin_zeta</span><span class="o">/</span><span class="n">cos_zeta</span><span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">mu</span><span class="p">),</span> <span class="n">tan</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">mu</span><span class="p">))</span>
<span class="n">print_eq</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\tan(\zeta)&quot;</span><span class="p">,</span> <span class="n">tan_zeta</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
        \begin{equation}
            \tan(\zeta) = - \frac{\left(\sin{\left (i \right )} \sin{\left (\iota  \right )} \cos{\left (d \right )} + \cos{\left (i \right )} \cos{\left (\iota  \right )}\right) \tan{\left (\mu  \right )}}{{\sin{\left (d \right )}}^{2} {\sin{\left (i \right )}}^{2} + \sin{\left (d \right )} {\sin{\left (i \right )}}^{2} \cos{\left (d \right )} \cos{\left (\iota  \right )} \tan{\left (\mu  \right )} - \sin{\left (d \right )} \sin{\left (i \right )} \sin{\left (\iota  \right )} \cos{\left (i \right )} \tan{\left (\mu  \right )} - 1} \nonumber
        \end{equation}
        \]</div>
<p>Check that <span class="arithmatex">\(\sin^2(\zeta) + \cos^2(\zeta) = 1\)</span></p>
<div class="highlight"><pre><span></span><code><span class="n">sp</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span> <span class="n">sp</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">(</span><span class="n">sin_zeta</span><span class="o">.</span><span class="n">obj</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">cos_zeta</span><span class="o">**</span><span class="mi">2</span> <span class="p">))</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle \frac{- \sin^{2}{\left(d \right)} \sin^{2}{\left(i \right)} \sin^{2}{\left(\iota \right)} \sin^{2}{\left(\mu \right)} + 2 \sin^{2}{\left(d \right)} \sin^{2}{\left(i \right)} \sin^{2}{\left(\mu \right)} - \sin^{2}{\left(d \right)} \sin^{2}{\left(i \right)} - 2 \sin{\left(d \right)} \sin^{2}{\left(i \right)} \sin{\left(\mu \right)} \cos{\left(d \right)} \cos{\left(\iota \right)} \cos{\left(\mu \right)} + 2 \sin{\left(d \right)} \sin{\left(i \right)} \sin{\left(\iota \right)} \sin{\left(\mu \right)} \cos{\left(i \right)} \cos{\left(\mu \right)} + 2 \sin^{2}{\left(i \right)} \sin^{2}{\left(\iota \right)} \sin^{2}{\left(\mu \right)} - \sin^{2}{\left(i \right)} \sin^{2}{\left(\mu \right)} + 2 \sin{\left(i \right)} \sin{\left(\iota \right)} \sin^{2}{\left(\mu \right)} \cos{\left(d \right)} \cos{\left(i \right)} \cos{\left(\iota \right)} - \sin^{2}{\left(\iota \right)} \sin^{2}{\left(\mu \right)} + 1}{\sin^{2}{\left(\Psi \right)}}\]</div>
<p>This is 1 if the numerator is equal to the denominator, and we have an explicit expression for <span class="arithmatex">\(\cos(\Psi) = \sqrt{1 - \sin^2(\Psi)}\)</span>. So should get zero from the following:</p>
<div class="highlight"><pre><span></span><code><span class="n">zeta_check</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">numer</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">cosPsi</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">zeta_check</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span> <span class="n">zeta_check</span> <span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 0\]</div>
<h3 id="the-shadow-length">The Shadow Length</h3>
<p>We have the angle of the shadow vector <span class="arithmatex">\(w\)</span>. Now find the length. Form <span class="arithmatex">\(w(p) = g + p*s\)</span> and enforce <span class="arithmatex">\(w(p) \wedge G = 0\)</span> (used <span class="arithmatex">\(\lambda\)</span> instead of <span class="arithmatex">\(p\)</span> in the paper but can't here because it's a keyword in Python).</p>
<div class="highlight"><pre><span></span><code><span class="n">G</span> <span class="o">=</span> <span class="n">e_frame</span><span class="p">(</span><span class="n">Gu</span><span class="p">)</span>
<span class="n">triangle_condition</span> <span class="o">=</span> <span class="p">((</span><span class="n">g</span> <span class="o">+</span> <span class="n">p</span><span class="o">*</span><span class="n">s</span><span class="p">)</span><span class="o">^</span><span class="n">G</span><span class="p">)</span> <span class="o">*</span> <span class="n">I</span>
<span class="n">display</span><span class="p">(</span> <span class="n">triangle_condition</span> <span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle p \sin{\left (\alpha  \right )} \sin{\left (i \right )} \sin{\left (\theta  \right )} \cos{\left (d \right )} \cos{\left (\sigma  \right )} + p \sin{\left (\alpha  \right )} \cos{\left (i \right )} \cos{\left (\sigma  \right )} \cos{\left (\theta  \right )} - p \sin{\left (d \right )} \sin{\left (i \right )} \sin{\left (\psi  \right )} \cos{\left (\alpha  \right )} \cos{\left (\sigma  \right )} + p \sin{\left (d \right )} \sin{\left (i \right )} \sin{\left (\sigma  \right )} \cos{\left (\psi  \right )} + p \sin{\left (i \right )} \sin{\left (\psi  \right )} \sin{\left (\sigma  \right )} \cos{\left (d \right )} \cos{\left (\theta  \right )} + p \sin{\left (i \right )} \cos{\left (\alpha  \right )} \cos{\left (d \right )} \cos{\left (\psi  \right )} \cos{\left (\sigma  \right )} \cos{\left (\theta  \right )} - p \sin{\left (\psi  \right )} \sin{\left (\sigma  \right )} \sin{\left (\theta  \right )} \cos{\left (i \right )} - p \sin{\left (\theta  \right )} \cos{\left (\alpha  \right )} \cos{\left (i \right )} \cos{\left (\psi  \right )} \cos{\left (\sigma  \right )} - \sin{\left (i \right )} \sin{\left (\iota  \right )} \cos{\left (d \right )} - \cos{\left (i \right )} \cos{\left (\iota  \right )}\]</div>
<div class="highlight"><pre><span></span><code><span class="n">p_soln</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">(</span><span class="n">triangle_condition</span><span class="o">.</span><span class="n">obj</span><span class="p">),</span> <span class="n">p</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">display</span><span class="p">(</span> <span class="n">p_soln</span> <span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle \frac{\sin{\left (i \right )} \sin{\left (\iota  \right )} \cos{\left (d \right )} + \cos{\left (i \right )} \cos{\left (\iota  \right )}}{\sin{\left (\alpha  \right )} \sin{\left (i \right )} \sin{\left (\theta  \right )} \cos{\left (d \right )} \cos{\left (\sigma  \right )} + \sin{\left (\alpha  \right )} \cos{\left (i \right )} \cos{\left (\sigma  \right )} \cos{\left (\theta  \right )} - \sin{\left (d \right )} \sin{\left (i \right )} \sin{\left (\psi  \right )} \cos{\left (\alpha  \right )} \cos{\left (\sigma  \right )} + \sin{\left (d \right )} \sin{\left (i \right )} \sin{\left (\sigma  \right )} \cos{\left (\psi  \right )} + \sin{\left (i \right )} \sin{\left (\psi  \right )} \sin{\left (\sigma  \right )} \cos{\left (d \right )} \cos{\left (\theta  \right )} + \sin{\left (i \right )} \cos{\left (\alpha  \right )} \cos{\left (d \right )} \cos{\left (\psi  \right )} \cos{\left (\sigma  \right )} \cos{\left (\theta  \right )} - \sin{\left (\psi  \right )} \sin{\left (\sigma  \right )} \sin{\left (\theta  \right )} \cos{\left (i \right )} - \sin{\left (\theta  \right )} \cos{\left (\alpha  \right )} \cos{\left (i \right )} \cos{\left (\psi  \right )} \cos{\left (\sigma  \right )}}\]</div>
<p>Now to simplify the denominator. Writing <span class="arithmatex">\(p = \frac{N}{D}\)</span>, we can write <span class="arithmatex">\(D\)</span> in terms of the hour angle <span class="arithmatex">\(\mu\)</span> (and sunray-gnomon angle <span class="arithmatex">\(\Xi\)</span>) evaluated under the condition <span class="arithmatex">\(\iota = \theta\)</span> and denoted <span class="arithmatex">\(\mu_s\)</span> (and <span class="arithmatex">\(\Xi_s\)</span>). This is true when the gnomon is parallel to the earth's axis, and termed a style, hence the subscript <span class="arithmatex">\(s\)</span>.</p>
<div class="highlight"><pre><span></span><code><span class="n">mu_s</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\mu_s&quot;</span><span class="p">)</span>
<span class="n">Xi_s</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\Xi_s&quot;</span><span class="p">)</span>
<span class="n">D_soln</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">Xi_s</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">sin</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">mu_s</span><span class="p">)</span> <span class="o">-</span> <span class="n">sin</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">mu_s</span><span class="p">))</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span><span class="o">*</span><span class="p">(</span> <span class="n">sin</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="p">)</span>
<span class="n">print_eq</span><span class="p">(</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">D_soln</span> <span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
        \begin{equation}
            D = \left(\left(\sin{\left (i \right )} \cos{\left (d \right )} \cos{\left (\theta  \right )} - \sin{\left (\theta  \right )} \cos{\left (i \right )}\right) \cos{\left (\mu_{s} \right )} - \sin{\left (\mu_{s} \right )} \sin{\left (d \right )} \sin{\left (i \right )}\right) \sin{\left (\Xi_{s} \right )} + \left(\sin{\left (i \right )} \sin{\left (\theta  \right )} \cos{\left (d \right )} + \cos{\left (i \right )} \cos{\left (\theta  \right )}\right) \sin{\left (\alpha  \right )} \cos{\left (\sigma  \right )} \nonumber
        \end{equation}
        \]</div>
<div class="highlight"><pre><span></span><code><span class="c1"># check</span>
<span class="n">D_explicit</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">D_soln</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">mu_s</span><span class="p">,</span><span class="n">mu</span><span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">Xi_s</span><span class="p">,</span><span class="n">Xi</span><span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">mu</span><span class="p">),</span><span class="n">sinXi_sin_mu</span><span class="o">/</span><span class="n">sin</span><span class="p">(</span><span class="n">Xi</span><span class="p">))</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">mu</span><span class="p">),</span><span class="n">sinXi_cos_mu</span><span class="o">/</span><span class="n">sin</span><span class="p">(</span><span class="n">Xi</span><span class="p">))</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">iota</span><span class="p">,</span><span class="n">theta</span><span class="p">))</span>
<span class="n">D_check</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">denom</span><span class="p">(</span><span class="n">p_soln</span><span class="p">)</span> <span class="o">-</span> <span class="n">D_explicit</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">D_check</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span> <span class="n">D_check</span> <span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 0\]</div>
<p>The factorization implicit in the above expression remains when <span class="arithmatex">\(\mu_s\)</span> and <span class="arithmatex">\(\Xi_s\)</span> are eliminated</p>
<div class="highlight"><pre><span></span><code><span class="n">print_eq</span><span class="p">(</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">D_explicit</span> <span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
        \begin{equation}
            D = \left(\sin{\left (\psi  \right )} \sin{\left (\sigma  \right )} + \cos{\left (\alpha  \right )} \cos{\left (\psi  \right )} \cos{\left (\sigma  \right )}\right) \left(\sin{\left (i \right )} \cos{\left (d \right )} \cos{\left (\theta  \right )} - \sin{\left (\theta  \right )} \cos{\left (i \right )}\right) + \left(\sin{\left (i \right )} \sin{\left (\theta  \right )} \cos{\left (d \right )} + \cos{\left (i \right )} \cos{\left (\theta  \right )}\right) \sin{\left (\alpha  \right )} \cos{\left (\sigma  \right )} - \left(\sin{\left (\psi  \right )} \cos{\left (\alpha  \right )} \cos{\left (\sigma  \right )} - \sin{\left (\sigma  \right )} \cos{\left (\psi  \right )}\right) \sin{\left (d \right )} \sin{\left (i \right )} \nonumber
        \end{equation}
        \]</div>
<p>Check:</p>
<div class="highlight"><pre><span></span><code><span class="n">D_explicit_check</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">denom</span><span class="p">(</span><span class="n">p_soln</span><span class="p">)</span> <span class="o">-</span> <span class="n">D_explicit</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">D_explicit_check</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span> <span class="n">D_explicit_check</span> <span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 0\]</div>
<p>So given <span class="arithmatex">\(p\)</span>, we have <span class="arithmatex">\(w = g + ps\)</span>. However, it is a little cumbersome to work with and we can get <span class="arithmatex">\(w\)</span> in terms of <span class="arithmatex">\(g\)</span>-<span class="arithmatex">\(ps\)</span>-<span class="arithmatex">\(w\)</span> triangle directly by projecting <span class="arithmatex">\(w\)</span> onto <span class="arithmatex">\(s\)</span> and <span class="arithmatex">\(g\)</span> to give two equations we can solve for <span class="arithmatex">\(p\)</span> and <span class="arithmatex">\(L\)</span>, the length of <span class="arithmatex">\(w\)</span>. We have</p>
<div class="arithmatex">\[s\cdot w = L\cos(\Xi-\beta) = s\cdot g + p\, s\cdot s = \cos(\Xi) + p\]</div>
<p>and</p>
<div class="arithmatex">\[g\cdot w = L\cos(\beta) = g\cdot g + p g\cdot s = 1 + p\, \cos(\Xi)\]</div>
<p>This yields two simultaneous equations for <span class="arithmatex">\(p\)</span> and <span class="arithmatex">\(L\)</span>, with solutions</p>
<div class="arithmatex">\[p = \frac{\sin(\beta)}{\sin(\Xi-\beta)}\]</div>
<p>and</p>
<div class="arithmatex">\[L = \frac{\sin(\Xi)}{\sin(\Xi-\beta)}\]</div>
<p>First define <span class="arithmatex">\(w\)</span> on the <span class="arithmatex">\(n\)</span> basis</p>
<div class="highlight"><pre><span></span><code><span class="n">wu</span> <span class="o">=</span> <span class="n">gu</span> <span class="o">+</span> <span class="n">p</span><span class="o">*</span><span class="n">su</span>
<span class="n">print_vec</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">wu</span><span class="p">,</span> <span class="s2">&quot;u&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
            \begin{align}
            w &amp; = p \sin{\left (\alpha  \right )} \sin{\left (\theta  \right )} \cos{\left (\sigma  \right )} + p \sin{\left (\psi  \right )} \sin{\left (\sigma  \right )} \cos{\left (\theta  \right )} + p \cos{\left (\alpha  \right )} \cos{\left (\psi  \right )} \cos{\left (\sigma  \right )} \cos{\left (\theta  \right )} - \sin{\left (\iota  \right )} u_1 \nonumber \\
            &amp; + - p \sin{\left (\psi  \right )} \cos{\left (\alpha  \right )} \cos{\left (\sigma  \right )} + p \sin{\left (\sigma  \right )} \cos{\left (\psi  \right )} u_2 \nonumber \\
            &amp; + - p \sin{\left (\alpha  \right )} \cos{\left (\sigma  \right )} \cos{\left (\theta  \right )} + p \sin{\left (\psi  \right )} \sin{\left (\sigma  \right )} \sin{\left (\theta  \right )} + p \sin{\left (\theta  \right )} \cos{\left (\alpha  \right )} \cos{\left (\psi  \right )} \cos{\left (\sigma  \right )} + \cos{\left (\iota  \right )} u_3 \nonumber
            \end{align}
            \]</div>
<p>Then check that <span class="arithmatex">\(p + \cos(\Xi)\)</span> is equal to the projection of <span class="arithmatex">\(w\)</span> onto <span class="arithmatex">\(s\)</span></p>
<div class="highlight"><pre><span></span><code><span class="n">ws_check</span> <span class="o">=</span> <span class="p">(</span><span class="n">su</span><span class="o">|</span><span class="n">wu</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">cosXi</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">ws_check</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span> <span class="n">ws_check</span> <span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle  0 \]</div>
<p>Now check that <span class="arithmatex">\(1 + p\cos(\Xi)\)</span> is equal to the projection of <span class="arithmatex">\(w\)</span> onto <span class="arithmatex">\(g\)</span></p>
<div class="highlight"><pre><span></span><code><span class="n">wg_check</span> <span class="o">=</span> <span class="p">(</span><span class="n">gu</span><span class="o">|</span><span class="n">wu</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">p</span><span class="o">*</span><span class="n">cosXi</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">wg_check</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span> <span class="n">wg_check</span> <span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle  0 \]</div>
<p>Given that <span class="arithmatex">\(\sin(\beta)\)</span> appears in the solution for <span class="arithmatex">\(p\)</span>, it will be useful to have its explicit form, which is</p>
<div class="highlight"><pre><span></span><code><span class="n">sin_beta</span> <span class="o">=</span> <span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">iota</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">iota</span><span class="p">))</span><span class="o">/</span><span class="n">sin</span><span class="p">(</span><span class="n">Psi</span><span class="p">)</span>
<span class="n">print_eq</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\sin(\beta)&quot;</span><span class="p">,</span> <span class="n">sin_beta</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
        \begin{equation}
            \sin(\beta) = \frac{\sin{\left (i \right )} \sin{\left (\iota  \right )} \cos{\left (d \right )} + \cos{\left (i \right )} \cos{\left (\iota  \right )}}{\sin{\left (\Psi \right )}} \nonumber
        \end{equation}
        \]</div>
<p>Confirm this by checking that <span class="arithmatex">\(\sin^2(\beta) + \cos^2(\beta) - 1 = 0\)</span></p>
<div class="highlight"><pre><span></span><code><span class="n">cos_beta</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">((</span><span class="n">gu</span><span class="o">|</span><span class="n">what</span><span class="p">)</span><span class="o">.</span><span class="n">obj</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">mu</span><span class="p">))</span>
<span class="n">print_eq</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\cos(\beta)&quot;</span><span class="p">,</span> <span class="n">cos_beta</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
        \begin{equation}
            \cos(\beta) = \frac{\left(\sin{\left (i \right )} \cos{\left (d \right )} \cos{\left (\iota  \right )} - \sin{\left (\iota  \right )} \cos{\left (i \right )}\right) \cos{\left (\mu  \right )} - \sin{\left (d \right )} \sin{\left (i \right )} \sin{\left (\mu  \right )}}{\sin{\left (\Psi \right )}} \nonumber
        \end{equation}
        \]</div>
<div class="highlight"><pre><span></span><code><span class="n">beta_check</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">numer</span><span class="p">(</span><span class="n">sin_beta</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">sp</span><span class="o">.</span><span class="n">numer</span><span class="p">(</span><span class="n">cos_beta</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">cosPsi</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">beta_check</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span> <span class="n">beta_check</span> <span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 0\]</div>
<p>Give <span class="arithmatex">\(\tan(\beta)\)</span> as in the paper</p>
<div class="highlight"><pre><span></span><code><span class="n">print_eq</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\tan(\beta)&quot;</span><span class="p">,</span> <span class="n">sin_beta</span><span class="o">/</span><span class="n">cos_beta</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
        \begin{equation}
            \tan(\beta) = \frac{\sin{\left (i \right )} \sin{\left (\iota  \right )} \cos{\left (d \right )} + \cos{\left (i \right )} \cos{\left (\iota  \right )}}{\left(\sin{\left (i \right )} \cos{\left (d \right )} \cos{\left (\iota  \right )} - \sin{\left (\iota  \right )} \cos{\left (i \right )}\right) \cos{\left (\mu  \right )} - \sin{\left (d \right )} \sin{\left (i \right )} \sin{\left (\mu  \right )}} \nonumber
        \end{equation}
        \]</div>
<p>We can now use the form of <span class="arithmatex">\(p\)</span> found by solving <span class="arithmatex">\(w\wedge G = 0\)</span> to obtain <span class="arithmatex">\(\sin(\Xi)\)</span>. First note that <span class="arithmatex">\(N\)</span>, the numerator of <span class="arithmatex">\(p\)</span>, is related to <span class="arithmatex">\(\beta\)</span> via</p>
<div class="arithmatex">\[\sin(\beta) = \frac{N}{\sin(\Psi)}\]</div>
<p>Check</p>
<div class="highlight"><pre><span></span><code><span class="n">sin_beta_check</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">numer</span><span class="p">(</span><span class="n">p_soln</span><span class="p">)</span><span class="o">/</span><span class="n">sin</span><span class="p">(</span><span class="n">Psi</span><span class="p">)</span> <span class="o">-</span> <span class="n">sin_beta</span>
<span class="k">assert</span> <span class="n">sin_beta_check</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span> <span class="n">sin_beta_check</span> <span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 0\]</div>
<p>Given our solution for <span class="arithmatex">\(p\)</span>, we can write</p>
<div class="arithmatex">\[p = \frac{\sin(\beta)}{\sin(\Xi-\beta)} = \frac{N}{D}\]</div>
<p>Eliminating <span class="arithmatex">\(N\)</span> using the above relationship with <span class="arithmatex">\(\beta\)</span> and solving for <span class="arithmatex">\(D\)</span> gives</p>
<div class="arithmatex">\[D = \sin(\Psi)\sin(\Xi-\beta)\]</div>
<p>Note that using this to eliminate <span class="arithmatex">\(\sin(\Xi-\beta)\)</span> in our solution for <span class="arithmatex">\(L\)</span> gives</p>
<div class="arithmatex">\[L = \frac{\sin(\Xi)\sin(\Psi)}{D}\]</div>
<p>Expanding the double angle in <span class="arithmatex">\(D\)</span> and solving for <span class="arithmatex">\(\sin(\Xi)\)</span> gives</p>
<div class="arithmatex">\[\sin(\Xi) = \frac{D + N\cos(\Xi)}{B}\]</div>
<p>where</p>
<div class="arithmatex">\[\cos(\beta) = \frac{B}{\sin(\Psi)}\]</div>
<p>Thus</p>
<div class="highlight"><pre><span></span><code><span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">denom</span><span class="p">(</span><span class="n">p_soln</span><span class="p">)</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">Psi</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">Xi</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">Psi</span><span class="p">))</span>
<span class="n">sinXi</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">beta</span><span class="p">),</span><span class="n">sin_beta</span><span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="p">),</span><span class="n">cos_beta</span><span class="p">)</span>
<span class="n">print_eq</span><span class="p">(</span> <span class="sa">r</span><span class="s2">&quot;\sin(\Xi)&quot;</span><span class="p">,</span> <span class="n">sinXi</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
        \begin{equation}
            \sin(\Xi) = \frac{\left(\sin{\left (i \right )} \sin{\left (\iota  \right )} \cos{\left (d \right )} + \cos{\left (i \right )} \cos{\left (\iota  \right )}\right) \cos{\left (\Xi \right )} + \sin{\left (\alpha  \right )} \sin{\left (i \right )} \sin{\left (\theta  \right )} \cos{\left (d \right )} \cos{\left (\sigma  \right )} + \sin{\left (\alpha  \right )} \cos{\left (i \right )} \cos{\left (\sigma  \right )} \cos{\left (\theta  \right )} - \sin{\left (d \right )} \sin{\left (i \right )} \sin{\left (\psi  \right )} \cos{\left (\alpha  \right )} \cos{\left (\sigma  \right )} + \sin{\left (d \right )} \sin{\left (i \right )} \sin{\left (\sigma  \right )} \cos{\left (\psi  \right )} + \sin{\left (i \right )} \sin{\left (\psi  \right )} \sin{\left (\sigma  \right )} \cos{\left (d \right )} \cos{\left (\theta  \right )} + \sin{\left (i \right )} \cos{\left (\alpha  \right )} \cos{\left (d \right )} \cos{\left (\psi  \right )} \cos{\left (\sigma  \right )} \cos{\left (\theta  \right )} - \sin{\left (\psi  \right )} \sin{\left (\sigma  \right )} \sin{\left (\theta  \right )} \cos{\left (i \right )} - \sin{\left (\theta  \right )} \cos{\left (\alpha  \right )} \cos{\left (i \right )} \cos{\left (\psi  \right )} \cos{\left (\sigma  \right )}}{\left(\sin{\left (i \right )} \cos{\left (d \right )} \cos{\left (\iota  \right )} - \sin{\left (\iota  \right )} \cos{\left (i \right )}\right) \cos{\left (\mu  \right )} - \sin{\left (d \right )} \sin{\left (i \right )} \sin{\left (\mu  \right )}} \nonumber
        \end{equation}
        \]</div>
<h3 id="the-shadow-coordinates">The Shadow Coordinates</h3>
<p>Let's now get the cartesian coordinates of the shadow tip in the dial face frame.</p>
<div class="arithmatex">\[w = L \hat{w}\]</div>
<p>and so can work with <span class="arithmatex">\(\hat{w}\)</span> and scale up by after.</p>
<div class="highlight"><pre><span></span><code><span class="n">print_eq</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\frac</span><span class="si">{x}{L}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">what</span><span class="o">|</span><span class="n">m1</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
        \begin{equation}
            \frac{x}{L} = \frac{- \sin{\left (d \right )} \sin{\left (\mu  \right )} \cos{\left (\iota  \right )} + \cos{\left (d \right )} \cos{\left (\mu  \right )}}{\sin{\left (\Psi \right )}} \nonumber
        \end{equation}
        \]</div>
<div class="highlight"><pre><span></span><code><span class="n">print_eq</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\frac</span><span class="si">{y}{L}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">mv</span><span class="o">.</span><span class="n">Mv</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">expand_trig</span><span class="p">((</span><span class="n">what</span><span class="o">|</span><span class="n">m2</span><span class="p">)</span><span class="o">.</span><span class="n">obj</span><span class="p">)),</span> <span class="n">ga</span><span class="o">=</span><span class="n">G3u</span><span class="p">))</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
        \begin{equation}
            \frac{y}{L} = - \frac{\sin{\left (d \right )} \cos{\left (i \right )} \cos{\left (\mu  \right )} + \sin{\left (i \right )} \sin{\left (\iota  \right )} \sin{\left (\mu  \right )} + \sin{\left (\mu  \right )} \cos{\left (d \right )} \cos{\left (i \right )} \cos{\left (\iota  \right )}}{\sin{\left (\Psi \right )}} \nonumber
        \end{equation}
        \]</div>
<div class="highlight"><pre><span></span><code><span class="n">print_eq</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\frac</span><span class="si">{z}{L}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">what</span><span class="o">|</span><span class="n">m3</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
        \begin{equation}
            \frac{z}{L} =  0  \nonumber
        \end{equation}
        \]</div>
<p>Check:</p>
<div class="highlight"><pre><span></span><code><span class="k">assert</span> <span class="p">(</span><span class="n">what</span><span class="o">|</span><span class="n">m1</span><span class="p">)</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">()</span><span class="o">.</span><span class="n">equals</span><span class="p">((</span><span class="o">-</span><span class="n">sin</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">iota</span><span class="p">)</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">mu</span><span class="p">))</span><span class="o">/</span><span class="n">sin</span><span class="p">(</span><span class="n">Psi</span><span class="p">))</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">what</span><span class="o">|</span><span class="n">m2</span><span class="p">)</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">()</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span><span class="o">+</span><span class="n">sin</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">iota</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span><span class="o">+</span><span class="n">sin</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">iota</span><span class="p">))</span><span class="o">/</span><span class="n">sin</span><span class="p">(</span><span class="n">Psi</span><span class="p">))</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">what</span><span class="o">|</span><span class="n">m3</span><span class="p">)</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">()</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>
<p>By substituting for <span class="arithmatex">\(L\)</span> using</p>
<div class="arithmatex">\[L = \frac{\sin(\Xi)\sin(\Psi)}{D}\]</div>
<p>we obtain</p>
<div class="highlight"><pre><span></span><code><span class="n">x_shadow</span> <span class="o">=</span> <span class="p">(</span><span class="n">what</span><span class="o">|</span><span class="n">m1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">Psi</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">Xi</span><span class="p">)</span> <span class="o">/</span> <span class="n">D</span>
<span class="n">print_eq</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x_shadow</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
        \begin{equation}
            x = \frac{\left(- \sin{\left (d \right )} \sin{\left (\mu  \right )} \cos{\left (\iota  \right )} + \cos{\left (d \right )} \cos{\left (\mu  \right )}\right) \sin{\left (\Xi \right )}}{D} \nonumber
        \end{equation}
        \]</div>
<div class="highlight"><pre><span></span><code><span class="n">y_shadow</span> <span class="o">=</span> <span class="n">mv</span><span class="o">.</span><span class="n">Mv</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">expand_trig</span><span class="p">((</span><span class="n">what</span><span class="o">|</span><span class="n">m2</span><span class="p">)</span><span class="o">.</span><span class="n">obj</span><span class="p">)),</span> <span class="n">ga</span><span class="o">=</span><span class="n">G3u</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">Psi</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">Xi</span><span class="p">)</span> <span class="o">/</span> <span class="n">D</span>
<span class="n">print_eq</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y_shadow</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
        \begin{equation}
            y = - \frac{\left(\sin{\left (d \right )} \cos{\left (i \right )} \cos{\left (\mu  \right )} + \sin{\left (i \right )} \sin{\left (\iota  \right )} \sin{\left (\mu  \right )} + \sin{\left (\mu  \right )} \cos{\left (d \right )} \cos{\left (i \right )} \cos{\left (\iota  \right )}\right) \sin{\left (\Xi \right )}}{D} \nonumber
        \end{equation}
        \]</div>
<p>We have explicit forms for <span class="arithmatex">\(\sin(\Xi)\sin(\mu)\)</span>, <span class="arithmatex">\(\sin(\Xi)\cos(\mu)\)</span> and <span class="arithmatex">\(D\)</span>, allowing the shadow coordinates to be expressed in terms of the Earth's orientation parameters <span class="arithmatex">\(\alpha\)</span>, <span class="arithmatex">\(\sigma\)</span>, and <span class="arithmatex">\(\psi\)</span>, together with the sundial parameters <span class="arithmatex">\(\theta\)</span>, <span class="arithmatex">\(i\)</span>, <span class="arithmatex">\(d\)</span> and <span class="arithmatex">\(\iota\)</span>:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">_simplify_shadow_coord_terms</span><span class="p">(</span><span class="n">term</span><span class="p">):</span>
    <span class="n">term</span> <span class="o">=</span> <span class="n">term</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">mu</span><span class="p">),</span> <span class="n">sinXi_sin_mu</span><span class="o">/</span><span class="n">sin</span><span class="p">(</span><span class="n">Xi</span><span class="p">))</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">mu</span><span class="p">),</span> <span class="n">sinXi_cos_mu</span><span class="o">/</span><span class="n">sin</span><span class="p">(</span><span class="n">Xi</span><span class="p">))</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span><span class="o">.</span><span class="n">obj</span>
    <span class="n">term</span> <span class="o">=</span> <span class="n">term</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">sigma</span><span class="p">),</span> <span class="n">tan</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">sigma</span><span class="p">))</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">sp</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">cos</span><span class="p">(</span><span class="n">psi</span><span class="p">)),</span> <span class="n">sin</span><span class="p">(</span><span class="n">psi</span><span class="p">)),</span> <span class="n">tan</span><span class="p">(</span><span class="n">sigma</span><span class="p">))</span>

<span class="n">x_explicit</span> <span class="o">=</span> <span class="n">_simplify_shadow_coord_terms</span><span class="p">((</span><span class="n">what</span><span class="o">|</span><span class="n">m1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">Psi</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">Xi</span><span class="p">))</span> <span class="o">/</span> <span class="n">D_explicit</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">sigma</span><span class="p">),</span> <span class="n">tan</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">sigma</span><span class="p">))</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span>
<span class="n">print_eq</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x_explicit</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
        \begin{equation}
            x = \frac{\left(- \sin{\left (d \right )} \cos{\left (\alpha  \right )} \cos{\left (\iota  \right )} + \cos{\left (d \right )} \cos{\left (\iota  - \theta  \right )} \tan{\left (\sigma  \right )}\right) \sin{\left (\psi  \right )} + \left(\sin{\left (d \right )} \cos{\left (\iota  \right )} \tan{\left (\sigma  \right )} + \cos{\left (\alpha  \right )} \cos{\left (d \right )} \cos{\left (\iota  - \theta  \right )}\right) \cos{\left (\psi  \right )} - \sin{\left (\alpha  \right )} \sin{\left (\iota  - \theta  \right )} \cos{\left (d \right )}}{- \left(\sin{\left (\psi  \right )} \cos{\left (\alpha  \right )} - \cos{\left (\psi  \right )} \tan{\left (\sigma  \right )}\right) \sin{\left (d \right )} \sin{\left (i \right )} + \left(\sin{\left (\psi  \right )} \tan{\left (\sigma  \right )} + \cos{\left (\alpha  \right )} \cos{\left (\psi  \right )}\right) \left(\sin{\left (i \right )} \cos{\left (d \right )} \cos{\left (\theta  \right )} - \sin{\left (\theta  \right )} \cos{\left (i \right )}\right) + \left(\sin{\left (i \right )} \sin{\left (\theta  \right )} \cos{\left (d \right )} + \cos{\left (i \right )} \cos{\left (\theta  \right )}\right) \sin{\left (\alpha  \right )}} \nonumber
        \end{equation}
        \]</div>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">_simplify_shadow_coord_terms</span><span class="p">(</span><span class="n">term</span><span class="p">):</span>
    <span class="n">term</span> <span class="o">=</span> <span class="n">term</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">mu</span><span class="p">),</span> <span class="n">sinXi_sin_mu</span><span class="o">/</span><span class="n">sin</span><span class="p">(</span><span class="n">Xi</span><span class="p">))</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">mu</span><span class="p">),</span> <span class="n">sinXi_cos_mu</span><span class="o">/</span><span class="n">sin</span><span class="p">(</span><span class="n">Xi</span><span class="p">))</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span><span class="o">.</span><span class="n">obj</span>
    <span class="n">term</span> <span class="o">=</span> <span class="n">term</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">sigma</span><span class="p">),</span> <span class="n">tan</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">sigma</span><span class="p">))</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">sp</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">cos</span><span class="p">(</span><span class="n">psi</span><span class="p">)),</span> <span class="n">sin</span><span class="p">(</span><span class="n">psi</span><span class="p">)),</span> <span class="n">tan</span><span class="p">(</span><span class="n">sigma</span><span class="p">))</span>

<span class="n">y_explicit</span> <span class="o">=</span> <span class="n">_simplify_shadow_coord_terms</span><span class="p">(</span><span class="n">mv</span><span class="o">.</span><span class="n">Mv</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">trigsimp</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">expand_trig</span><span class="p">((</span><span class="n">what</span><span class="o">|</span><span class="n">m2</span><span class="p">)</span><span class="o">.</span><span class="n">obj</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">Psi</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">Xi</span><span class="p">)),</span> <span class="n">ga</span><span class="o">=</span><span class="n">G3u</span><span class="p">))</span> <span class="o">/</span> <span class="n">D_explicit</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">sigma</span><span class="p">),</span> <span class="n">tan</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">sigma</span><span class="p">))</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span>
<span class="n">print_eq</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y_explicit</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[\displaystyle 
        \begin{equation}
            y = \frac{\left(\left(\sin{\left (i \right )} \sin{\left (\iota  \right )} + \cos{\left (d \right )} \cos{\left (i \right )} \cos{\left (\iota  \right )}\right) \tan{\left (\sigma  \right )} - \sin{\left (d \right )} \cos{\left (\alpha  \right )} \cos{\left (i \right )} \cos{\left (\iota  - \theta  \right )}\right) \cos{\left (\psi  \right )} + \left(- \sin{\left (d \right )} \cos{\left (i \right )} \cos{\left (\iota  - \theta  \right )} \tan{\left (\sigma  \right )} - \sin{\left (i \right )} \sin{\left (\iota  \right )} \cos{\left (\alpha  \right )} - \cos{\left (\alpha  \right )} \cos{\left (d \right )} \cos{\left (i \right )} \cos{\left (\iota  \right )}\right) \sin{\left (\psi  \right )} + \sin{\left (\alpha  \right )} \sin{\left (d \right )} \sin{\left (\iota  - \theta  \right )} \cos{\left (i \right )}}{- \left(\sin{\left (\psi  \right )} \cos{\left (\alpha  \right )} - \cos{\left (\psi  \right )} \tan{\left (\sigma  \right )}\right) \sin{\left (d \right )} \sin{\left (i \right )} + \left(\sin{\left (\psi  \right )} \tan{\left (\sigma  \right )} + \cos{\left (\alpha  \right )} \cos{\left (\psi  \right )}\right) \left(\sin{\left (i \right )} \cos{\left (d \right )} \cos{\left (\theta  \right )} - \sin{\left (\theta  \right )} \cos{\left (i \right )}\right) + \left(\sin{\left (i \right )} \sin{\left (\theta  \right )} \cos{\left (d \right )} + \cos{\left (i \right )} \cos{\left (\theta  \right )}\right) \sin{\left (\alpha  \right )}} \nonumber
        \end{equation}
        \]</div>
<h3 id="angle-between-sun-ray-and-dial-face">Angle Between Sun Ray and Dial Face</h3>
<p>It will be important for plotting analemmas to determine an effective sunrise and sunset for the given sundial, defined as the points in the sun's journey across the sky when the angle between the sun ray <span class="arithmatex">\(s\)</span> and dial face <span class="arithmatex">\(G\)</span> is zero (or <span class="arithmatex">\(\pi\)</span>). This angle is given by
<span class="arithmatex">\(<span class="arithmatex">\(-(G\wedge s) \cdot I\)</span>\)</span></p>
<div class="highlight"><pre><span></span><code><span class="o">-</span><span class="p">(</span><span class="n">G</span><span class="o">^</span><span class="n">s</span><span class="p">)</span><span class="o">|</span><span class="n">I</span>
</code></pre></div>
<div class="arithmatex">\[\begin{equation*} - \sin{\left (\alpha  \right )} \sin{\left (i \right )} \sin{\left (\theta  \right )} \cos{\left (d \right )} \cos{\left (\sigma  \right )} - \sin{\left (\alpha  \right )} \cos{\left (i \right )} \cos{\left (\sigma  \right )} \cos{\left (\theta  \right )} + \sin{\left (d \right )} \sin{\left (i \right )} \sin{\left (\psi  \right )} \cos{\left (\alpha  \right )} \cos{\left (\sigma  \right )} - \sin{\left (d \right )} \sin{\left (i \right )} \sin{\left (\sigma  \right )} \cos{\left (\psi  \right )} - \sin{\left (i \right )} \sin{\left (\psi  \right )} \sin{\left (\sigma  \right )} \cos{\left (d \right )} \cos{\left (\theta  \right )} - \sin{\left (i \right )} \cos{\left (\alpha  \right )} \cos{\left (d \right )} \cos{\left (\psi  \right )} \cos{\left (\sigma  \right )} \cos{\left (\theta  \right )} + \sin{\left (\psi  \right )} \sin{\left (\sigma  \right )} \sin{\left (\theta  \right )} \cos{\left (i \right )} + \sin{\left (\theta  \right )} \cos{\left (\alpha  \right )} \cos{\left (i \right )} \cos{\left (\psi  \right )} \cos{\left (\sigma  \right )} \end{equation*}\]</div>
<h2 id="test-sundial-module">Test <code>sundial</code> Module</h2>
<p>Check consistency with <code>sundial</code> Python module.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">sundial</span> <span class="k">as</span> <span class="nn">sd</span>
<span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">utilities</span> <span class="k">as</span> <span class="n">util</span>
<span class="kn">import</span> <span class="nn">math</span><span class="o">,</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">args</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;alpha&quot;</span><span class="p">:</span><span class="n">sd</span><span class="o">.</span><span class="n">earth</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span> <span class="s2">&quot;sigma&quot;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.4</span><span class="p">,</span> <span class="s2">&quot;psi&quot;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">27</span><span class="p">,</span> <span class="s2">&quot;iota&quot;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">7</span><span class="p">,</span> <span class="s2">&quot;theta&quot;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">9</span><span class="p">,</span> <span class="s2">&quot;i&quot;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">40</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">43</span><span class="p">}</span>

<span class="n">x_num</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">lambdify</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">x_explicit</span><span class="p">)</span>
<span class="n">x_val</span> <span class="o">=</span> <span class="n">x_num</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>

<span class="n">y_num</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">lambdify</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">y_explicit</span><span class="p">)</span>
<span class="n">y_val</span> <span class="o">=</span> <span class="n">y_num</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>

<span class="p">(</span><span class="n">x_py_val</span><span class="p">,</span> <span class="n">y_py_val</span><span class="p">)</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">shadow_coords_xy</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">x_val</span><span class="p">,</span> <span class="n">x_py_val</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_py_val</span><span class="p">)</span>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.07f07601.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.56dfad97.min.js"></script>
      
        <script src="../javascripts/katex.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/contrib/auto-render.min.js"></script>
      
    
  </body>
</html>